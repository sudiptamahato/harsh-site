<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harsh Edits - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* ========== Premium Admin UI Styles ========== */

        /* Custom Scrollbar with Glow */
        * {
            scrollbar-width: thin;
            scrollbar-color: #6366f1 rgba(15, 23, 42, 0.5);
        }

        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }

        *::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        *::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.8);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #000000;
            color: #e2e8f0;
            position: relative;
        }

        /* Aurora Background Animation */
        .aurora-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        .aurora-shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
            will-change: transform;
        }

        .shape1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.3), transparent);
            top: -10%;
            left: -10%;
            animation-duration: 25s;
        }

        .shape2 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.25), transparent);
            top: 50%;
            right: -10%;
            animation-duration: 30s;
            animation-delay: -5s;
        }

        .shape3 {
            width: 700px;
            height: 700px;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.2), transparent);
            bottom: -15%;
            left: 30%;
            animation-duration: 35s;
            animation-delay: -10s;
        }

        .shape4 {
            width: 550px;
            height: 550px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.25), transparent);
            top: 20%;
            left: 50%;
            animation-duration: 28s;
            animation-delay: -15s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1);
            }

            25% {
                transform: translate(50px, -50px) scale(1.1);
            }

            50% {
                transform: translate(-30px, 30px) scale(0.9);
            }

            75% {
                transform: translate(40px, 60px) scale(1.05);
            }
        }

        /* Enhanced Glassmorphism */
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            box-shadow:
                0 8px 32px 0 rgba(0, 0, 0, 0.37),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(400px circle at var(--x, 50%) var(--y, 50%), rgba(99, 102, 241, 0.3), transparent 40%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .glass-card:hover::before {
            opacity: 1;
        }

        .glass-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow:
                0 20px 60px rgba(99, 102, 241, 0.3),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }

        /* Sidebar Enhancements */
        aside {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            border-right: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 10;
        }

        aside::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(to bottom,
                    transparent,
                    rgba(99, 102, 241, 0.5),
                    transparent);
        }

        .sidebar-link {
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(to bottom, #6366f1, #8b5cf6);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .sidebar-link:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(4px);
            box-shadow: -4px 0 12px rgba(99, 102, 241, 0.2);
        }

        .sidebar-link:hover::before {
            transform: scaleY(1);
        }

        .sidebar-link.active {
            background: linear-gradient(135deg,
                    rgba(99, 102, 241, 0.2) 0%,
                    rgba(139, 92, 246, 0.2) 100%);
            border-left: 3px solid #6366f1;
            color: white;
            box-shadow:
                -4px 0 16px rgba(99, 102, 241, 0.3),
                inset 0 0 20px rgba(99, 102, 241, 0.1);
        }

        .sidebar-link.active::before {
            transform: scaleY(1);
        }

        /* Collapsible Sidebar */
        aside {
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        aside.collapsed {
            width: 0;
            overflow: hidden;
            border-right: none;
        }

        main.sidebar-collapsed {
            margin-left: 0 !important;
        }

        /* Sidebar Toggle Button */
        .sidebar-toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .sidebar-toggle-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.5);
            transform: scale(1.05);
        }

        .sidebar-toggle-btn svg {
            width: 1.25rem;
            height: 1.25rem;
            color: #a5b4fc;
            transition: transform 0.3s;
        }

        .sidebar-toggle-btn.active svg {
            transform: rotate(90deg);
        }

        /* Colorful Section Groups */
        /* Dashboard - Blue/Indigo */
        .sidebar-link[data-tab="dashboard"] {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(79, 70, 229, 0.08));
            border-left: 2px solid rgba(99, 102, 241, 0.3);
        }

        .sidebar-link[data-tab="dashboard"]:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(79, 70, 229, 0.15));
        }

        .sidebar-link[data-tab="dashboard"].active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(79, 70, 229, 0.25));
            border-left-color: #6366f1;
        }

        /* Content Sections - Purple/Pink */
        .sidebar-link[data-tab="easyWorkflow"],
        .sidebar-link[data-tab="adobeSoftware"],
        .sidebar-link[data-tab="plugins"],
        .sidebar-link[data-tab="scripts"],
        .sidebar-link[data-tab="assets"],
        .sidebar-link[data-tab="utilities"],
        .sidebar-link[data-tab="courses"],
        .sidebar-link[data-tab="banners"],
        .sidebar-link[data-tab="simplePluginsList"] {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.08), rgba(147, 51, 234, 0.08));
            border-left: 2px solid rgba(168, 85, 247, 0.3);
        }

        .sidebar-link[data-tab="easyWorkflow"]:hover,
        .sidebar-link[data-tab="adobeSoftware"]:hover,
        .sidebar-link[data-tab="plugins"]:hover,
        .sidebar-link[data-tab="scripts"]:hover,
        .sidebar-link[data-tab="assets"]:hover,
        .sidebar-link[data-tab="utilities"]:hover,
        .sidebar-link[data-tab="courses"]:hover,
        .sidebar-link[data-tab="banners"]:hover,
        .sidebar-link[data-tab="simplePluginsList"]:hover {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(147, 51, 234, 0.15));
        }

        .sidebar-link[data-tab="easyWorkflow"].active,
        .sidebar-link[data-tab="adobeSoftware"].active,
        .sidebar-link[data-tab="plugins"].active,
        .sidebar-link[data-tab="scripts"].active,
        .sidebar-link[data-tab="assets"].active,
        .sidebar-link[data-tab="utilities"].active,
        .sidebar-link[data-tab="courses"].active,
        .sidebar-link[data-tab="banners"].active,
        .sidebar-link[data-tab="simplePluginsList"].active {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.25), rgba(147, 51, 234, 0.25));
            border-left-color: #a855f7;
        }

        /* Broken Link Reports & User Messages - Green */
        .sidebar-link[data-tab="userMessages"],
        .sidebar-link[data-tab="brokenLinks"] {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.08), rgba(22, 163, 74, 0.08));
            border-left: 2px solid rgba(34, 197, 94, 0.3);
        }

        .sidebar-link[data-tab="userMessages"]:hover,
        .sidebar-link[data-tab="brokenLinks"]:hover {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15));
        }

        .sidebar-link[data-tab="userMessages"].active,
        .sidebar-link[data-tab="brokenLinks"].active {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.25), rgba(22, 163, 74, 0.25));
            border-left-color: #22c55e;
        }

        /* Website Users & Settings - Yellow */
        .sidebar-link[data-tab="websiteUsers"],
        .sidebar-link[data-tab="imageAssets"],
        .sidebar-link[data-tab="siteSettings"] {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.08), rgba(202, 138, 4, 0.08));
            border-left: 2px solid rgba(234, 179, 8, 0.3);
        }

        .sidebar-link[data-tab="websiteUsers"]:hover,
        .sidebar-link[data-tab="imageAssets"]:hover,
        .sidebar-link[data-tab="siteSettings"]:hover {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(202, 138, 4, 0.15));
        }

        .sidebar-link[data-tab="websiteUsers"].active,
        .sidebar-link[data-tab="imageAssets"].active,
        .sidebar-link[data-tab="siteSettings"].active {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.25), rgba(202, 138, 4, 0.25));
            border-left-color: #eab308;
        }

        /* Enhanced Button Styling */
        .btn-with-icon {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-with-icon svg {
            width: 1.125rem;
            height: 1.125rem;
        }

        /* Gradient Text with Animation */
        .gradient-text {
            background: linear-gradient(90deg, #a78bfa, #f472b6, #818cf8);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 5s linear infinite;
        }

        @keyframes gradient-flow {
            to {
                background-position: 200% center;
            }
        }

        /* Enhanced Gradient Buttons */
        .btn-primary,
        .gradient-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
        }

        .btn-primary::before,
        .gradient-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:hover::before,
        .gradient-btn:hover::before {
            width: 150px;
            height: 150px;
        }

        .btn-primary:hover,
        .gradient-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* ========== Custom Modals ========== */
        /* Modal Backdrop */
        .custom-modal {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .custom-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
        }

        /* Glass Modal Content */
        .custom-modal-content {
            position: relative;
            z-index: 10000;
            max-width: 400px;
            width: 90%;
            padding: 2rem;
            text-align: center;

            /* Premium glass effect */
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.5rem;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);

            animation: modalSlideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* ========== Toast Notifications ========== */
        #toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            pointer-events: none;
        }

        .toast {
            pointer-events: auto;
            min-width: 320px;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: toastSlideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: all 0.3s ease;
            transform-origin: bottom right;
        }

        .toast.toast-hiding {
            animation: toastFadeOut 0.3s ease forwards;
        }

        .toast-icon {
            flex-shrink: 0;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.1rem;
        }

        .toast-message {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .toast-close {
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
        }

        .toast-close:hover {
            color: white;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes toastFadeOut {
            to {
                opacity: 0;
                transform: translateX(20px) scale(0.9);
            }
        }

        /* Toast Variations */
        .toast-success .toast-icon {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .toast-success {
            border-left: 3px solid #22c55e;
        }

        .toast-error .toast-icon {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .toast-error {
            border-left: 3px solid #ef4444;
        }

        .toast-info .toast-icon {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .toast-info {
            border-left: 3px solid #6366f1;
        }

        /* Modal Icon */
        .modal-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border: 2px solid rgba(99, 102, 241, 0.5);
        }

        .modal-icon svg {
            width: 2rem;
            height: 2rem;
            color: #a5b4fc;
        }

        /* Modal Text */
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .modal-message {
            font-size: 1rem;
            color: #cbd5e1;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* Modal Buttons */
        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
        }

        .modal-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #cbd5e1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* ========== Header Role Badge ========== */
        .header-role-badge {
            padding: 0.5rem 2rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 3rem;
            box-shadow:
                0 4px 20px rgba(99, 102, 241, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        .header-role-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3),
                    transparent);
            animation: shimmer 3s infinite;
        }

        .role-text {
            font-size: 1.25rem;
            font-weight: 900;
            letter-spacing: 0.2em;
            color: #ffffff;
            text-transform: uppercase;
            animation: glow-pulse 3s ease-in-out infinite;
            display: block;
        }

        @keyframes glow-pulse {

            0%,
            100% {
                text-shadow:
                    0 0 10px rgba(255, 255, 255, 0.5),
                    0 0 20px rgba(168, 85, 247, 0.5);
            }

            50% {
                text-shadow:
                    0 0 20px rgba(255, 255, 255, 0.8),
                    0 0 40px rgba(168, 85, 247, 0.8);
            }
        }

        .input-enhanced {
            transition: all 0.3s ease;
        }

        .input-enhanced:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Enhanced Form Inputs with Glassmorphism */
        input,
        textarea,
        select {
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            background: rgba(15, 23, 42, 0.7);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow:
                0 0 0 3px rgba(99, 102, 241, 0.1),
                0 4px 12px rgba(99, 102, 241, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transform: translateY(-1px);
        }

        /* 3D Card Effects for Item Grid */
        #items-grid>div {
            perspective: 1000px;
        }

        #items-grid .glass-card {
            transform-style: preserve-3d;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #items-grid .glass-card:hover {
            transform: translateY(-12px) rotateX(3deg) scale(1.03);
            box-shadow: 0 25px 70px rgba(99, 102, 241, 0.4);
        }

        /* Modal 3D Animations */
        #item-modal {
            backdrop-filter: blur(16px);
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Dashboard Stat Cards */
        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.25rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle,
                    rgba(99, 102, 241, 0.1) 0%,
                    transparent 70%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .stat-card:hover::after {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.3);
        }

        /* Loading Shimmer Effect */
        .loading-shimmer {
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0.0) 0%,
                    rgba(255, 255, 255, 0.1) 50%,
                    rgba(255, 255, 255, 0.0) 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }



        /* Interactive Card 3D Tilt */
        .interactive-card {
            perspective: 1000px;
        }

        .interactive-card .glass-card {
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        /* Line Clamp Fix */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* ==================== Login Screen Revamp ==================== */

        /* Light Leaks Animation Background */
        .light-leaks-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            background: #050510;
            /* Deep dark background */
        }

        .light-leak {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float-leak 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }

        .leak-1 {
            top: -10%;
            left: -10%;
            width: 50vw;
            height: 50vw;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.4), transparent 70%);
            /* Violet */
            animation-duration: 25s;
        }

        .leak-2 {
            bottom: -10%;
            right: -10%;
            width: 60vw;
            height: 60vw;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.3), transparent 70%);
            /* Pink */
            animation-duration: 30s;
            animation-delay: -5s;
        }

        .leak-3 {
            top: 40%;
            left: 40%;
            width: 40vw;
            height: 40vw;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.3), transparent 70%);
            /* Cyan */
            animation-duration: 35s;
            animation-delay: -10s;
        }

        @keyframes float-leak {
            0% {
                transform: translate(0, 0) scale(1);
            }

            50% {
                transform: translate(30px, 50px) scale(1.1);
            }

            100% {
                transform: translate(-20px, -30px) scale(0.9);
            }
        }

        /* Premium Login Glass Card */
        .login-glass-card {
            position: relative;
            z-index: 10;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            padding: 3rem;
            width: 100%;
            max-width: 420px;
            animation: card-enter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes card-enter {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Input With Icon */
        .login-input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .login-input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            transition: color 0.3s;
            pointer-events: none;
        }

        .login-input {
            width: 100%;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 0.875rem 1rem 0.875rem 3rem;
            /* Left padding for icon */
            color: #fff;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .login-input:focus {
            background: rgba(15, 23, 42, 0.8);
            border-color: #8b5cf6;
            /* Violet focus */
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .login-input:focus+.login-input-icon {
            color: #a78bfa;
            /* Violet icon on focus */
        }

        /* Glowing Login Button */
        .login-btn-glow {
            width: 100%;
            padding: 0.875rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
            color: white;
            background: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
            background-size: 200% 200%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            animation: gradient-anim 5s ease infinite;
        }

        .login-btn-glow:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
        }

        @keyframes gradient-anim {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }
    </style>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="custom-modal hidden">
        <div class="custom-modal-backdrop"></div>
        <div class="custom-modal-content glass-card">
            <div class="modal-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="modal-title">Notice</h3>
            <p class="modal-message">Message text goes here</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="custom-modal hidden">
        <div class="custom-modal-backdrop"></div>
        <div class="custom-modal-content glass-card">
            <div class="modal-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h3 class="modal-title">Confirm Action</h3>
            <p class="modal-message">Are you sure you want to proceed?</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary">Cancel</button>
                <button class="modal-btn modal-btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Firebase Compat SDKs (Realtime Database) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body class="h-screen flex overflow-hidden">

    <!-- Animated Aurora Background -->
    <div class="aurora-container">
        <div class="aurora-shape shape1"></div>
        <div class="aurora-shape shape2"></div>
        <div class="aurora-shape shape3"></div>
        <div class="aurora-shape shape4"></div>
    </div>

    <!-- Mouse Follower Glow -->
    <div id="mouse-follower"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center overflow-hidden">
        <!-- Light Leaks Background -->
        <div class="light-leaks-container">
            <div class="light-leak leak-1"></div>
            <div class="light-leak leak-2"></div>
            <div class="light-leak leak-3"></div>
        </div>

        <!-- Premium Glass Card -->
        <div class="login-glass-card">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-black text-white tracking-tight mb-2">Harsh<span
                        class="gradient-text">Admin</span></h1>
                <p class="text-gray-400 text-sm">Welcome back! Please enter your details to access admin panel.</p>
            </div>

            <form id="login-form">
                <div class="login-input-group">
                    <input type="email" id="login-email" class="login-input" placeholder="Email Address" required>
                    <div class="login-input-icon">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
                        </svg>
                    </div>
                </div>

                <div class="login-input-group">
                    <input type="password" id="login-password" class="login-input" placeholder="Password" required>
                    <div class="login-input-icon">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                </div>

                <button type="submit" class="login-btn-glow mt-2">
                    Login
                </button>

                <p id="login-error"
                    class="text-red-400 text-sm text-center mt-4 hidden bg-red-500/10 py-2 rounded border border-red-500/20">
                </p>
            </form>


        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="hidden flex w-full h-full">
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col">
            <div class="p-6">
                <h1 class="text-2xl font-black text-white">Harsh<span class="text-indigo-500">Admin</span></h1>
            </div>
            <nav class="flex-1 px-4 space-y-2 overflow-y-auto">
                <button onclick="switchTab('dashboard')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="dashboard">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    <span>Dashboard</span>
                </button>
                <button onclick="switchTab('banners')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="banners">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>Banners</span>
                </button>

                <button onclick="switchTab('adobeSoftware')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="adobeSoftware">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                    </svg>
                    <span>Adobe Software</span>
                </button>
                <button onclick="switchTab('plugins')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="plugins">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" />
                    </svg>
                    <span>Plugins</span>
                </button>
                <button onclick="switchTab('scripts')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="scripts">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                    </svg>
                    <span>Scripts & Extensions</span>
                </button>
                <button onclick="switchTab('assets')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="assets">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>Assets</span>
                </button>
                <button onclick="switchTab('utilities')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="utilities">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>Utilities & Other Software</span>
                </button>
                <button onclick="switchTab('courses')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="courses">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <span>Courses</span>
                </button>
                <button onclick="switchTab('simplePluginsList')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="simplePluginsList">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <span>100+ Plugins List</span>
                </button>
                <button onclick="switchTab('userMessages')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="userMessages">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                    <span>User Messages</span>
                </button>
                <button onclick="switchTab('brokenLinks')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="brokenLinks">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <span>Broken Links</span>
                </button>
                <button onclick="switchTab('websiteUsers')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="websiteUsers">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <span>Website Users</span>
                </button>
                <button onclick="switchTab('imageAssets')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="imageAssets">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>Image Assets</span>
                </button>
                <button onclick="switchTab('siteSettings')"
                    class="sidebar-link w-full text-left px-4 py-3 rounded-lg text-gray-400 hover:bg-gray-800 transition-colors flex items-center gap-3"
                    data-tab="siteSettings">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>Settings</span>
                </button>
            </nav>
            <div class="p-4 border-t border-gray-800">
                <button id="logout-btn"
                    class="w-full bg-red-600/20 hover:bg-red-600/40 text-red-500 font-semibold py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0 bg-gray-900/50">
            <header class="bg-gray-900 border-b border-gray-800 p-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button id="sidebar-toggle" class="sidebar-toggle-btn" title="Toggle Sidebar">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <h2 id="page-title" class="text-2xl font-bold text-white">Dashboard</h2>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Search Bar -->
                    <div id="search-bar-container" class="relative hidden">
                        <input type="text" id="search-input" placeholder="Search items..."
                            class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-64 pl-10 p-2.5"
                            oninput="filterItems(this.value)">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <svg class="w-4 h-4 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 20 20">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                            </svg>
                        </div>
                    </div>

                    <div id="add-item-btn-container">
                        <button onclick="openModal()"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold transition-all shadow-lg shadow-indigo-500/30 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4" />
                            </svg>
                            Add New
                        </button>
                    </div>
                    <div id="bulk-import-btn-container" class="hidden">
                        <button onclick="openBulkImportModal()"
                            class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-bold transition-all shadow-lg shadow-emerald-500/30 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                            Bulk Import
                        </button>
                    </div>
                </div>
            </header>

            <div id="content-area" class="flex-1 p-6 overflow-y-auto">
                <div id="loading" class="text-center py-10 hidden">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-indigo-500"></div>
                </div>
                <div id="items-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                <!-- Dashboard Section -->
                <div id="dashboard-container" class="hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-white mb-2">Dashboard Overview</h2>
                        <p class="text-gray-400">Quick statistics and content summary</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
                        id="dashboard-stats">
                        <!-- Loading state -->
                        <div class="col-span-full text-center py-12">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-indigo-500">
                            </div>
                            <p class="text-gray-400 mt-4">Loading dashboard...</p>
                        </div>
                    </div>
                </div>

                <!-- Banners Content Section -->
                <div id="banners-container" class="hidden space-y-8">
                    <!-- Carousel Settings Card -->
                    <div class="glass-card p-8 relative overflow-hidden group">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-purple-600/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        </div>

                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-2">Carousel Settings</h3>
                                <p class="text-gray-400 text-sm">Configure the main carousel behavior.</p>
                            </div>
                            <button onclick="saveCarouselSettings()"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-lg shadow-lg shadow-indigo-600/20 font-medium transition-all transform hover:scale-105 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                Save Settings
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                            <!-- Auto Slide Toggle -->
                            <div
                                class="bg-gray-800/50 p-6 rounded-xl border border-gray-700/50 flex items-center justify-between">
                                <div>
                                    <h4 class="text-white font-semibold text-lg mb-1">Auto Slide</h4>
                                    <p class="text-gray-400 text-sm">Automatically cycle through banners</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="carousel-auto-slide" class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600 shadow-inner">
                                    </div>
                                </label>
                            </div>

                            <!-- Slide Speed Slider -->
                            <div class="bg-gray-800/50 p-6 rounded-xl border border-gray-700/50">
                                <div class="flex justify-between mb-2">
                                    <label for="carousel-slide-speed" class="text-white font-semibold">Slide
                                        Speed</label>
                                    <span id="slide-speed-value"
                                        class="text-indigo-400 font-bold bg-indigo-500/10 px-2 py-0.5 rounded text-sm">5s</span>
                                </div>
                                <input type="range" id="carousel-slide-speed" min="2" max="10" step="1" value="5"
                                    class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-indigo-500 hover:accent-indigo-400 transition-all">
                                <div class="flex justify-between text-xs text-gray-500 mt-2">
                                    <span>2s (Fast)</span>
                                    <span>10s (Slow)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Banners Management -->
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2
                                class="text-2xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
                                Manage Banners</h2>
                            <button onclick="openBannerModal()"
                                class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white px-6 py-3 rounded-xl shadow-lg shadow-indigo-600/30 font-bold transition-all transform hover:scale-105 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                                        clip-rule="evenodd" />
                                </svg>
                                Add Banner
                            </button>
                        </div>

                        <!-- Banners List -->
                        <div id="banners-list-container" class="grid grid-cols-1 gap-4">
                            <!-- Dynamic Banners Here -->
                            <div
                                class="text-center py-12 text-gray-500 bg-gray-900/30 rounded-2xl border border-gray-800 border-dashed">
                                <svg class="w-16 h-16 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <p class="text-xl font-semibold">No banners yet.</p>
                                <p class="text-sm mt-2">Click "Add Banner" to verify your first dynamic slide.</p>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Settings Form Container (New Design) -->
                <div id="settings-container" class="hidden w-full max-w-7xl mx-auto space-y-8">

                    <!-- Top Grid: settings & Order -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                        <!-- Left Col: Links & Identity -->
                        <div class="glass-card p-8 border border-indigo-500/20 h-full">
                            <div class="flex items-center gap-3 mb-6">
                                <div
                                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-blue-600 flex items-center justify-center text-2xl shadow-lg">
                                    
                                </div>
                                <div>
                                    <h4 class="text-2xl font-bold text-white">Site Identity & Links</h4>
                                    <p class="text-sm text-gray-400">Manage external links and QR code</p>
                                </div>
                            </div>

                            <form id="settings-form" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Discord Invite
                                        URL</label>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500"></span>
                                        </div>
                                        <input type="url" id="setting-discord" placeholder="https://discord.gg/..."
                                            class="w-full bg-gray-700/50 border border-gray-600 rounded-lg pl-10 pr-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">QR Code Image</label>
                                    <div class="flex gap-2 mb-4">
                                        <input type="text" id="setting-qr"
                                            class="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none"
                                            placeholder="enter image URL or select from assets..."
                                            oninput="updatePreview(this, 'preview-setting-qr')">
                                        <button type="button" onclick="openImagePicker('setting-qr')"
                                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 rounded-lg transition-colors whitespace-nowrap flex items-center gap-2">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                                </path>
                                            </svg>
                                            Assets
                                        </button>
                                    </div>

                                    <!-- QR Preview Box -->
                                    <div
                                        class="w-64 h-64 mx-auto bg-gray-900/50 rounded-xl border-2 border-dashed border-gray-700 flex items-center justify-center overflow-hidden relative group hover:border-indigo-500 transition-colors">
                                        <img id="preview-setting-qr" src="" class="w-full h-full object-contain hidden">
                                        <div id="qr-placeholder" class="text-center text-gray-500">
                                            <svg class="w-12 h-12 mx-auto mb-2 opacity-50" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4c1 0 2 1 2 2v6c0 1-1 2-2 2H6c-1 0-2-1-2-2v-6c0-1 1-2 2-2h6z">
                                                </path>
                                            </svg>
                                            <span class="text-sm">QR Code Preview</span>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit"
                                    class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg shadow-blue-500/20 transform hover:-translate-y-0.5 flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                    </svg>
                                    Save Identity Settings
                                </button>
                            </form>
                        </div>

                        <!-- Right Col: Section Order -->
                        <div class="glass-card p-8 border border-purple-500/20 h-full flex flex-col">
                            <div class="flex items-center gap-3 mb-6">
                                <div
                                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center text-2xl shadow-lg">
                                    
                                </div>
                                <div>
                                    <h4 class="text-2xl font-bold text-white">Section Order</h4>
                                    <p class="text-sm text-gray-400">Drag items to rearrange homepage</p>
                                </div>
                            </div>

                            <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                                <div id="section-order-list" class="space-y-3">
                                    <!-- Draggable Items -->
                                </div>
                            </div>

                            <!-- Unsaved Indicator -->
                            <div id="unsaved-changes-badge"
                                class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg hidden animate-pulse">
                                <p class="text-sm text-yellow-300 flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Unsaved Changes!
                                </p>
                            </div>

                            <div class="mt-6 flex gap-3">
                                <button id="save-section-order-btn" disabled
                                    class="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 disabled:from-gray-700 disabled:to-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 rounded-xl transition-all shadow-lg disabled:shadow-none flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span id="save-btn-text">Save Order</span>
                                </button>
                                <button id="reset-section-order-btn"
                                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold px-4 rounded-xl transition-colors flex items-center justify-center"
                                    title="Reset Default">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Row: Section Names & Site Text Config -->
                    <div class="glass-card p-8 border border-blue-500/20">
                        <div class="flex items-center gap-3 mb-6">
                            <div
                                class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 flex items-center justify-center text-2xl shadow-lg">
                                
                            </div>
                            <div>
                                <h4 class="text-2xl font-bold text-white">Content Configuration</h4>
                                <p class="text-sm text-gray-400">Manage section names and site text</p>
                            </div>
                        </div>

                        <!-- We need a new form specifically for this, or reuse the existing settings-form logic.
                             The existing JS likely listens to 'settings-form' submit.
                             To avoid breaking JS, I will WRAP this bottom section in a new form 
                             BUT WAIT, the original code had ONE form for links, sections, and site text.
                             If I split them, the single submit button in the Left Col won't save these.
                             
                             CORRECTION: I should move the form tag to wrap the ENTIRE container or enable separate saving. 
                             The JS looked for `settings-form` submission. 
                             
                             Best Approach: 
                             Keep `settings-form` ID on the Left Col form for Identity.
                             Create a NEW form and NEW JS handler for this Bottom Section?
                             OR: Move the inputs back into the main form?
                             
                             Let's check `admin.html` JS... 
                             `loadSettings` loads everything.
                             `settings-form` submit saves `discordUrl` and `qrCodeUrl`.
                             WAIT, `siteText` and `sectionNames` saving logic might be missing or separate?
                             
                             Let's look at the previous `admin.html` view (around line 4367).
                             It only saved `discordUrl` and `qrCodeUrl`.
                             
                             Ah, I see `applySiteText` function but where is the SAVE logic for site text?
                             It seems I might have added the Site Text UI in a previous step but maybe didn't verify the SAVE logic in JS.
                             
                             Actually, looking at the previous view (lines 1400+), the HTML *had* input fields for Site Text.
                             I need to ensure there is JS to save them.
                             
                             For now, let's restore the UI structure first.
                             I'll add a specific "Save Content Settings" button for this section and update JS later if needed.
                             
                             To allow the existing `settings-form` to work for Identity, I'll keep it there.
                             I'll create a `content-settings-form` for this bottom section.
                        -->

                        <form id="content-settings-form" class="space-y-8">
                            <!-- Section Names -->
                            <div>
                                <h5
                                    class="text-lg font-bold text-white mb-4 flex items-center gap-2 border-b border-gray-700 pb-2">
                                    Section Display Names
                                </h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Adobe
                                            Software</label>
                                        <input type="text" id="section-name-adobeSoftware" placeholder="Adobe Software"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Plugins</label>
                                        <input type="text" id="section-name-plugins" placeholder="Plugins"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Scripts</label>
                                        <input type="text" id="section-name-scripts" placeholder="Scripts & Extensions"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Assets</label>
                                        <input type="text" id="section-name-assets" placeholder="Assets"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Utilities</label>
                                        <input type="text" id="section-name-utilities" placeholder="Utilities"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">Courses</label>
                                        <input type="text" id="section-name-courses" placeholder="Courses"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-2">100+ Plugins
                                            List</label>
                                        <input type="text" id="section-name-simplePluginsList"
                                            placeholder="100+ Plugins List"
                                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                </div>
                            </div>

                            <!-- Site Text -->
                            <div>
                                <h5
                                    class="text-lg font-bold text-white mb-4 flex items-center gap-2 border-b border-gray-700 pb-2">
                                    Site Text Content
                                </h5>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Hero -->
                                    <div class="bg-gray-800/20 p-5 rounded-xl border border-gray-700/50">
                                        <h6 class="text-sm font-bold text-indigo-400 mb-4 uppercase tracking-wider">Hero
                                            Section</h6>
                                        <div class="space-y-3">
                                            <input type="text" id="site-text-heroTitle1" placeholder="Title Line 1"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                            <input type="text" id="site-text-heroTitle2" placeholder="Title Line 2"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                            <textarea id="site-text-heroDescription" rows="2"
                                                placeholder="Hero Description"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"></textarea>
                                        </div>
                                    </div>

                                    <!-- Plugins Pack -->
                                    <div class="bg-gray-800/20 p-5 rounded-xl border border-gray-700/50">
                                        <h6 class="text-sm font-bold text-purple-400 mb-4 uppercase tracking-wider">100+
                                            Plugins Pack</h6>
                                        <div class="space-y-3">
                                            <input type="text" id="site-text-pluginsPackTitle" placeholder="Title"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                            <textarea id="site-text-pluginsPackDescription" rows="2"
                                                placeholder="Description"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"></textarea>
                                        </div>
                                    </div>

                                    <!-- Plugins List -->
                                    <div class="bg-gray-800/20 p-5 rounded-xl border border-gray-700/50">
                                        <h6 class="text-sm font-bold text-blue-400 mb-4 uppercase tracking-wider">
                                            Plugins List Page</h6>
                                        <div class="space-y-3">
                                            <input type="text" id="site-text-pluginsListTitle" placeholder="Page Title"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                            <textarea id="site-text-pluginsListDescription" rows="2"
                                                placeholder="Description"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"></textarea>
                                        </div>
                                    </div>

                                    <!-- Missing Resource -->
                                    <div class="bg-gray-800/20 p-5 rounded-xl border border-gray-700/50">
                                        <h6 class="text-sm font-bold text-green-400 mb-4 uppercase tracking-wider">
                                            Missing Resource</h6>
                                        <div class="space-y-3">
                                            <input type="text" id="site-text-missingResourceTitle" placeholder="Title"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                            <textarea id="site-text-missingResourceDescription" rows="2"
                                                placeholder="Description"
                                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end pt-4">
                                <button type="submit"
                                    class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-3 px-8 rounded-xl transition-all shadow-lg shadow-blue-500/20 transform hover:-translate-y-0.5 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                    </svg>
                                    Save Content Configuration
                                </button>
                            </div>
                        </form>
                    </div>
                    <!-- Close settings-container after user-management-section instead of here -->

                    <!-- Authentication Settings -->
                    <div class="mt-8 pt-8 border-t border-gray-700">
                        <h3 class="text-2xl font-bold text-white mb-6">Authentication Settings (Auth Page)</h3>
                        <div class="glass-card p-6 border border-indigo-500/20">
                            <h5
                                class="text-lg font-bold text-white mb-4 flex items-center gap-2 border-b border-gray-700 pb-2">
                                Forgot Password Modal
                            </h5>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Modal Title</label>
                                    <input type="text" id="auth-forgot-title" placeholder="e.g. Reset Password"
                                        class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Modal Message</label>
                                    <textarea id="auth-forgot-text" rows="3"
                                        placeholder="e.g. Please contact the administrator via WhatsApp to reset your password."
                                        class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm resize-none"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Wrapper Button
                                        Text</label>
                                    <input type="text" id="auth-forgot-btn-text" placeholder="e.g. Contact Admin"
                                        class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Action Button
                                        URL</label>
                                    <input type="text" id="auth-forgot-url" placeholder="e.g. https://wa.me/..."
                                        class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
                                </div>
                            </div>
                            <div class="flex justify-end pt-4">
                                <button onclick="saveAuthSettings()"
                                    class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-2 px-6 rounded-lg transition-all shadow-lg shadow-purple-500/20 transform hover:-translate-y-0.5">
                                    Save Auth Settings
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- User Management Section -->
                    <div id="user-management-section" class="mt-8 pt-8 border-t border-gray-700 hidden">
                        <h3 class="text-2xl font-bold text-white mb-6">User Management (Sub-Admins)</h3>

                        <!-- Add User Form -->
                        <div class="glass-card p-8 mb-8 border border-indigo-500/20">
                            <div class="flex items-center gap-3 mb-6">
                                <div
                                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-2xl shadow-lg">
                                    
                                </div>
                                <div>
                                    <h4 id="user-form-title" class="text-2xl font-bold text-white">Add New Sub-Admin
                                    </h4>
                                    <p class="text-sm text-gray-400">Create a new sub-admin account with custom
                                        permissions</p>
                                </div>
                            </div>

                            <form id="add-user-form" class="space-y-6">
                                <input type="hidden" id="edit-user-id">

                                <!-- Basic Info -->
                                <div class="space-y-4">
                                    <label
                                        class="block text-sm font-semibold text-indigo-300 uppercase tracking-wider">Basic
                                        Information</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                </svg>
                                            </div>
                                            <input type="text" id="new-user-name" placeholder="Full Name"
                                                class="w-full pl-12 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                                                required>
                                        </div>
                                        <div class="relative">
                                            <div
                                                class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                            <input type="email" id="new-user-email" placeholder="Email Address"
                                                class="w-full pl-12 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                                                required>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-500">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                            </svg>
                                        </div>
                                        <input type="text" id="new-user-password" placeholder="Password"
                                            class="w-full pl-12 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                                            required>
                                    </div>
                                </div>

                                <!-- Permissions -->
                                <div class="space-y-4">
                                    <label
                                        class="block text-sm font-semibold text-indigo-300 uppercase tracking-wider">Access
                                        Permissions</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-purple-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="adobeSoftware"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Adobe
                                                Software</span>
                                        </label>
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-blue-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="plugins"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Plugins</span>
                                        </label>
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-green-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="scripts"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-green-600 focus:ring-green-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Scripts
                                                & Extensions</span>
                                        </label>
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-orange-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="assets"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-orange-600 focus:ring-orange-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Assets</span>
                                        </label>
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-indigo-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="utilities"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-indigo-600 focus:ring-indigo-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Utilities</span>
                                        </label>
                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-teal-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="simplePluginsList"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-teal-600 focus:ring-teal-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">100+
                                                Plugins List</span>
                                        </label>

                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-emerald-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="courses"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-emerald-600 focus:ring-emerald-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Courses</span>
                                        </label>

                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-purple-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="banners"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Banners</span>
                                        </label>

                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-red-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="brokenLinkReports"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-red-600 focus:ring-red-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">Broken
                                                Link Reports</span>
                                        </label>

                                        <label
                                            class="group relative flex items-center gap-3 p-4 bg-gray-800/30 hover:bg-gray-800/60 border border-gray-700/50 hover:border-rose-500/50 rounded-xl cursor-pointer transition-all duration-200">
                                            <input type="checkbox" name="user-sections" value="userMessages"
                                                class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-rose-600 focus:ring-rose-500 focus:ring-offset-0 transition-all">
                                            <span class="text-2xl"></span>
                                            <span
                                                class="text-sm font-medium text-gray-300 group-hover:text-white transition-colors">User
                                                Messages</span>
                                        </label>

                                    </div>
                                </div>

                                <button type="submit"
                                    class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-indigo-500/50 transform hover:scale-[1.02]">
                                    <span class="flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 4v16m8-8H4" />
                                        </svg>
                                        Create Sub-Admin
                                    </span>
                                </button>
                            </form>
                        </div>

                        <!-- User List -->
                        <div class="glass-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="bg-gray-800/50 text-gray-400 text-sm uppercase">
                                            <th class="p-4">Name</th>
                                            <th class="p-4">Email</th>
                                            <th class="p-4">Access</th>
                                            <th class="p-4">Status</th>
                                            <th class="p-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="user-list-body" class="divide-y divide-gray-700/50">
                                        <!-- Users loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Website Users Management Section -->
                <div id="website-users-container" class="hidden">
                    <div class="glass-card p-6 mb-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-1">Website Users</h3>
                                <p class="text-sm text-gray-400">Manage registered website users (Config 2 Database)</p>
                            </div>
                            <div class="relative">
                                <input type="text" id="user-search-input" placeholder="Search by name or email..."
                                    class="bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-500 outline-none w-64"
                                    oninput="filterWebsiteUsers(this.value)">
                                <svg class="w-4 h-4 text-gray-400 absolute left-3 top-3" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="flex gap-2 mb-4 border-b border-gray-700 pb-4">
                            <button onclick="filterUserStatus('all')"
                                class="user-filter-btn active px-3 py-1.5 rounded-lg text-sm font-medium bg-indigo-600 text-white transition-colors"
                                data-filter="all">All Users</button>
                            <button onclick="filterUserStatus('active')"
                                class="user-filter-btn px-3 py-1.5 rounded-lg text-sm font-medium bg-gray-800 text-gray-400 hover:text-white transition-colors"
                                data-filter="active">Active</button>
                            <button onclick="filterUserStatus('banned')"
                                class="user-filter-btn px-3 py-1.5 rounded-lg text-sm font-medium bg-gray-800 text-gray-400 hover:text-white transition-colors"
                                data-filter="banned">Banned</button>
                        </div>

                        <!-- Users Table -->
                        <div class="glass-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="bg-gray-800/50 text-gray-400 text-sm uppercase">
                                            <th class="p-4">User</th>
                                            <th class="p-4">Email</th>
                                            <th class="p-4">Password</th>
                                            <th class="p-4">Joined</th>
                                            <th class="p-4">Last Login</th>
                                            <th class="p-4">Favorites</th>
                                            <th class="p-4">Status</th>
                                            <th class="p-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="website-users-list" class="divide-y divide-gray-700/50">
                                        <!-- Dynamic Content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Loading State -->
                        <div id="users-loading" class="text-center py-8 hidden">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-indigo-500">
                            </div>
                            <p class="text-gray-500 text-sm mt-2">Loading users...</p>
                        </div>
                    </div>
                </div>

                <!-- User Messages Container -->
                <div id="user-messages-container" class="hidden">
                    <div class="glass-card p-6 mb-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-1">User Messages</h3>
                                <p class="text-sm text-gray-400">Manage user requests and feedback</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span id="messages-count"
                                    class="px-3 py-1 bg-indigo-600/20 text-indigo-400 rounded-full text-sm font-semibold"></span>
                                <button id="delete-all-messages-btn" onclick="deleteAllMessages()"
                                    class="hidden bg-red-600/20 hover:bg-red-600/40 text-red-400 font-semibold px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                    Delete All
                                </button>
                            </div>
                        </div>

                        <!-- Filter/Sort Options -->
                        <div class="flex flex-wrap gap-3 mb-6 pb-4 border-b border-gray-700">
                            <button onclick="filterMessages('all')"
                                class="message-filter-btn active px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-indigo-600 text-white flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                All Messages
                            </button>
                            <button onclick="filterMessages('today')"
                                class="message-filter-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Today
                            </button>
                            <button onclick="filterMessages('week')"
                                class="message-filter-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                This Week
                            </button>
                        </div>

                        <div id="messages-list" class="space-y-3">
                            <!-- Messages will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Broken Link Reports Section -->
                <div id="broken-links-container" class="hidden space-y-6">

                    <!-- Stats Dashboard -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Total Reports -->
                        <div class="glass-card p-6 flex items-center justify-between relative overflow-hidden group">
                            <div class="relative z-10">
                                <p class="text-sm font-medium text-gray-400 uppercase tracking-wider mb-1">Total Reports
                                </p>
                                <h3 id="blr-total" class="text-3xl font-black text-white">0</h3>
                            </div>
                            <div class="p-3 bg-blue-500/10 rounded-xl border border-blue-500/20">
                                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                </svg>
                            </div>
                        </div>

                        <!-- Pending -->
                        <div class="glass-card p-6 flex items-center justify-between relative overflow-hidden group">
                            <div class="relative z-10">
                                <p class="text-sm font-medium text-gray-400 uppercase tracking-wider mb-1">Pending</p>
                                <h3 id="blr-pending" class="text-3xl font-black text-yellow-400">0</h3>
                            </div>
                            <div class="p-3 bg-yellow-500/10 rounded-xl border border-yellow-500/20">
                                <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                        </div>

                        <!-- Fixed -->
                        <div class="glass-card p-6 flex items-center justify-between relative overflow-hidden group">
                            <div class="relative z-10">
                                <p class="text-sm font-medium text-gray-400 uppercase tracking-wider mb-1">Fixed</p>
                                <h3 id="blr-fixed" class="text-3xl font-black text-green-400">0</h3>
                            </div>
                            <div class="p-3 bg-green-500/10 rounded-xl border border-green-500/20">
                                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Alert Bar (Pending Attention) -->
                    <div id="blr-alert-bar"
                        class="hidden bg-red-500/10 border border-red-500/20 rounded-lg p-3 flex items-center gap-3 animate-pulse">
                        <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <span id="blr-alert-text" class="text-red-200 text-sm font-medium">1 pending report needs
                            attention</span>
                    </div>

                    <div class="glass-card p-6">
                        <!-- Header & Filters -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                                Broken Link Reports
                                <span id="blr-badge"
                                    class="px-2 py-0.5 rounded-full bg-red-500/20 text-red-300 text-xs font-bold border border-red-500/30 hidden">1
                                    Pending</span>
                            </h3>

                            <div class="flex flex-wrap gap-3">
                                <!-- Search -->
                                <div class="relative">
                                    <input type="text" id="blr-search" placeholder="Search..."
                                        oninput="filterBrokenLinkReports()"
                                        class="bg-gray-800 border border-gray-700 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:ring-1 focus:ring-indigo-500 outline-none w-full md:w-56">
                                    <svg class="w-4 h-4 text-gray-500 absolute left-3 top-2.5" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </div>

                                <!-- Status Filter -->
                                <select id="blr-filter-status" onchange="filterBrokenLinkReports()"
                                    class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:ring-1 focus:ring-indigo-500 outline-none">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="fixed">Fixed</option>
                                </select>

                                <!-- Time Filter -->
                                <select id="blr-filter-time" onchange="filterBrokenLinkReports()"
                                    class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:ring-1 focus:ring-indigo-500 outline-none">
                                    <option value="all">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="glass-card overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead>
                                        <tr class="bg-gray-800/50 text-gray-400 text-sm uppercase">
                                            <th class="p-4">Resource</th>
                                            <th class="p-4">Category</th>
                                            <th class="p-4">Reporter</th>
                                            <th class="p-4">Info</th>
                                            <th class="p-4">Status</th> <!-- New Column -->
                                            <th class="p-4">Date</th>
                                            <th class="p-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="broken-links-table-body"
                                        class="divide-y divide-gray-700/50 text-gray-300">
                                        <!-- Dynamic API Content -->
                                    </tbody>
                                </table>
                                <div id="no-reports-msg" class="hidden text-center py-12">
                                    <svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <p class="text-gray-400 text-lg">No reports match your filters.</p>
                                </div>
                                <div id="reports-loading" class="text-center py-8 hidden">
                                    <div
                                        class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-indigo-500">
                                    </div>
                                    <p class="text-gray-500 text-sm mt-2">Loading reports...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Refresh Button (Floating or Footer) -->
                        <div class="mt-4 text-right">
                            <button onclick="loadBrokenLinkReports()"
                                class="text-xs text-indigo-400 hover:text-white flex items-center gap-1 justify-end ml-auto">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                Refresh Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Image Assets Manager -->
                <div id="image-assets-container" class="hidden">
                    <div class="glass-card p-6 mb-6">
                        <div class="mb-6">
                            <h3 class="text-2xl font-bold text-white mb-2">Image Assets Manager</h3>
                            <p class="text-sm text-gray-400">All images in your /assets folder are automatically
                                available. Use this section to register additional new images.</p>
                        </div>

                        <!-- Registration Form -->
                        <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-700/50 mb-6">
                            <h4 class="text-lg font-semibold text-white mb-4">Register New Image</h4>
                            <form id="register-asset-form" class="flex gap-3">
                                <input type="text" id="asset-filename"
                                    placeholder="Enter filename (e.g., test.png, logo.jpg)"
                                    class="flex-1 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 outline-none"
                                    required>
                                <button type="submit"
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-8 py-3 rounded-lg transition-colors shadow-lg shadow-indigo-600/20 whitespace-nowrap flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Register Image
                                </button>
                            </form>
                            <p class="text-xs text-gray-500 mt-3">
                                How to use: First upload your image to the <code
                                    class="bg-gray-700 px-1 rounded">/assets</code>
                                folder, then register it
                                here by entering its filename.
                            </p>
                        </div>

                        <!-- Hardcoded Images List -->
                        <div class="bg-gray-800/30 p-6 rounded-xl border border-gray-700/50 mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h4 class="text-lg font-semibold text-white">Hardcoded Images</h4>
                                    <p class="text-xs text-gray-500 mt-1">Images defined in the knownImages array</p>
                                </div>
                                <span id="hardcoded-count"
                                    class="px-3 py-1 bg-gray-700 text-gray-300 rounded-full text-sm font-semibold">0
                                    images</span>
                            </div>
                            <div id="hardcoded-images-list" class="max-h-64 overflow-y-auto custom-scrollbar">
                                <!-- Hardcoded images will be listed here -->
                            </div>
                        </div>

                        <!-- Registered Images Grid -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-white">Registered Images</h4>
                                <span id="assets-count"
                                    class="px-3 py-1 bg-indigo-600/20 text-indigo-400 rounded-full text-sm font-semibold">0
                                    images</span>
                            </div>
                            <div id="registered-assets-grid"
                                class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                                <!-- Registered images will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Modal -->
    <div id="item-modal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden overflow-y-auto py-10">
        <div class="glass-card p-8 w-full max-w-2xl max-h-full overflow-y-auto relative m-4">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 id="modal-title" class="text-2xl font-bold text-white mb-6">Add Item</h3>
            <form id="item-form" class="space-y-5">
                <input type="hidden" id="item-id">

                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-1.5 ml-1">Title</label>
                    <input type="text" id="item-title"
                        class="w-full bg-gray-800/80 border border-gray-700 focus:border-indigo-500 rounded-xl p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500/20 outline-none transition-all shadow-sm"
                        placeholder="Enter title..." required>
                </div>

                <div id="description-field">
                    <label class="block text-sm font-semibold text-gray-300 mb-1.5 ml-1">Description</label>
                    <textarea id="item-description" rows="3"
                        class="w-full bg-gray-800/80 border border-gray-700 focus:border-indigo-500 rounded-xl p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500/20 outline-none transition-all shadow-sm"
                        placeholder="Enter description..."></textarea>
                </div>

                <div id="download-description-field" class="hidden">
                    <label
                        class="block text-sm font-semibold text-gray-300 mb-1.5 ml-1 flex justify-between items-center">
                        Download Window Description
                        <button type="button" onclick="copyItemDetails(event)"
                            class="text-xs bg-indigo-500/20 hover:bg-indigo-500 hover:text-white text-indigo-400 px-3 py-1 rounded-lg transition-colors border border-indigo-500/30 flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy from Description
                        </button>
                    </label>
                    <textarea id="item-download-description" rows="4"
                        class="w-full bg-gray-800/80 border border-gray-700 focus:border-indigo-500 rounded-xl p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500/20 outline-none transition-all shadow-sm"
                        placeholder="Enter detailed description for download window..."></textarea>
                    <p class="text-xs text-gray-500 mt-1 ml-1">This description appears in the download modal window
                        (separate from card description)</p>
                </div>

                <div id="image-field" class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50">
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Image</label>
                    <div class="flex items-start gap-4">
                        <!-- Square Preview -->
                        <div class="flex-shrink-0">
                            <img id="preview-item-image" src="https://placehold.co/100?text=Preview"
                                class="w-28 h-28 object-cover rounded-lg border border-gray-600 bg-gray-900 shadow-lg">
                        </div>

                        <!-- Image Input & Picker -->
                        <div class="flex-1 space-y-3">
                            <div class="flex gap-2">
                                <input type="text" id="item-image"
                                    class="flex-1 bg-gray-800 border border-gray-700 rounded-lg p-2.5 text-white text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                    placeholder="Paste URL or select..."
                                    oninput="updatePreview(this, 'preview-item-image')">
                            </div>
                            <button type="button" onclick="openImagePicker('item-image')"
                                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm shadow-lg shadow-indigo-600/20">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Choose from Assets
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sub-Items Section (New) -->
                <div id="sub-items-section" class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50 hidden">
                    <label
                        class="flex items-center gap-3 cursor-pointer bg-gray-800 border border-gray-700 rounded-lg p-3 w-full hover:bg-gray-750 transition-colors mb-4">
                        <input type="checkbox" id="item-has-sub-items" onchange="toggleSubItemsConfig()"
                            class="w-5 h-5 rounded border-gray-600 text-indigo-600 focus:ring-indigo-500 bg-gray-700">
                        <span class="text-white font-medium">Enable Sub-Items Page</span>
                    </label>

                    <div id="sub-items-config" class="hidden space-y-4 border-t border-gray-700/50 pt-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-semibold text-gray-400 mb-1 ml-1">Button Text</label>
                                <input type="text" id="sub-items-btn-text"
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2.5 text-white text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                    placeholder="e.g. View All Resources" value="View All Resources">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-400 mb-1 ml-1">Page Title</label>
                                <input type="text" id="sub-items-page-title"
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2.5 text-white text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                    placeholder="e.g. Download Collection">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-400 mb-1 ml-1">Page Description</label>
                            <input type="text" id="sub-items-page-desc"
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2.5 text-white text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                placeholder="Brief description for the sub-items page...">
                        </div>

                        <!-- Sub-Items List Manager -->
                        <div class="bg-black/20 rounded-lg p-3 border border-gray-700/50">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Sub-Items
                                    List</label>
                                <button type="button" onclick="openSubItemsImportModal()"
                                    class="text-xs bg-indigo-500/20 hover:bg-indigo-500 hover:text-white text-indigo-400 px-2 py-1 rounded transition-colors border border-indigo-500/30">
                                    + Bulk Import
                                </button>
                            </div>
                            <div id="sub-items-list-container"
                                class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar p-1">
                                <p class="text-center text-gray-500 text-xs py-4 italic">No sub-items added yet.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Versions Section -->
                <div id="versions-section" class="bg-gray-800/30 p-4 rounded-xl border border-gray-700/50">
                    <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-semibold text-gray-300">Downloads / Versions</label>
                        <button type="button" onclick="addVersionField()"
                            class="text-indigo-400 hover:text-white bg-indigo-500/10 hover:bg-indigo-500/30 px-3 py-1 rounded-md text-xs font-semibold transition-colors border border-indigo-500/20">
                            + Add Version
                        </button>
                    </div>
                    <div id="versions-container" class="space-y-3 max-h-48 overflow-y-auto pr-1 custom-scrollbar"></div>
                </div>

                <!-- Single Download Link (for Assets & Simple List) -->
                <div id="single-link-section" class="hidden">
                    <label class="block text-sm font-medium text-gray-400 mb-1 ml-1">Download Link</label>
                    <div class="flex gap-2">
                        <input type="url" id="item-download-link"
                            class="flex-1 bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                        <button type="button"
                            onclick="const l=document.getElementById('item-download-link').value; if(l) window.open(l, '_blank'); else alert('No link provided')"
                            class="bg-gray-800 border border-gray-700 hover:bg-gray-700 text-indigo-400 p-3 rounded-lg transition-colors"
                            title="View Link">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="flex justify-end gap-3 pt-2">
                    <button type="button" onclick="closeModal()"
                        class="px-5 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors font-medium flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Cancel</button>
                    <button type="submit"
                        class="px-8 py-2.5 rounded-lg bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold shadow-lg shadow-indigo-600/30 transition-all transform hover:scale-[1.02] flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                        </svg>
                        Save
                        Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div id="bulk-import-modal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden">
        <div class="glass-card p-8 w-full max-w-2xl m-4">
            <h3 class="text-2xl font-bold text-white mb-4">Bulk Import Plugins</h3>
            <p class="text-gray-400 text-sm mb-4">Paste your list below. Each line should be independent.<br>Format:
                <code>Plugin Name | Download Link</code>
            </p>
            <textarea id="bulk-import-text" rows="10"
                placeholder="Example Plugin | https://example.com/dl&#10;Another Plugin | https://google.com"
                class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-emerald-500 outline-none font-mono text-sm"></textarea>
            <div class="flex justify-end gap-4 mt-6">
                <button onclick="closeBulkImportModal()"
                    class="px-6 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    Cancel</button>
                <button id="import-btn-action" onclick="importPlugins()"
                    class="px-6 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-bold transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    Import
                    Plugins</button>
            </div>
        </div>
    </div>



    <!-- Image Picker Modal -->
    <div id="image-picker-modal"
        class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-sm hidden overflow-y-auto py-10">
        <div class="glass-card p-8 w-full max-w-5xl max-h-[90vh] overflow-y-auto relative m-4">
            <button onclick="closeImagePicker()" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Choose Image from Assets Folder</h3>
                <!-- Refresh button removed as requested, images now auto-refresh on open -->
            </div>
            <div id="image-picker-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Images will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Message Detail Modal -->
    <div id="message-detail-modal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden overflow-y-auto py-10">
        <div class="glass-card p-8 w-full max-w-2xl max-h-full overflow-y-auto relative m-4">
            <button onclick="closeMessageModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-2xl font-bold text-white mb-6">Message Details</h3>

            <div class="space-y-6">
                <!-- User Info -->
                <div class="flex items-center gap-3 pb-4 border-b border-gray-700">
                    <div id="msg-modal-avatar"
                        class="w-12 h-12 rounded-full bg-indigo-600/20 flex items-center justify-center">
                        <span id="msg-modal-initial" class="text-indigo-400 font-bold text-lg"></span>
                    </div>
                    <div class="flex-1">
                        <h4 id="msg-modal-name" class="text-white font-semibold text-lg"></h4>
                        <p id="msg-modal-date" class="text-sm text-gray-400"></p>
                    </div>
                    <button id="msg-modal-delete-btn" onclick="deleteMessageFromModal()"
                        class="bg-red-600/20 hover:bg-red-600/40 text-red-400 font-semibold px-4 py-2 rounded-lg transition-colors">
                        Delete
                    </button>
                </div>

                <!-- Message Content -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Message</label>
                    <div id="msg-modal-content"
                        class="bg-gray-800/50 border border-gray-700 rounded-lg p-4 text-gray-300 whitespace-pre-wrap leading-relaxed min-h-[100px]">
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- User Favorites Modal -->
    <div id="user-favorites-modal"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden p-4">
        <div class="glass-card p-8 w-full max-w-lg max-h-[80vh] flex flex-col relative">
            <button onclick="closeFavoritesModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h3 class="text-2xl font-bold text-white mb-2">User Favorites</h3>
            <p id="fav-modal-username" class="text-indigo-400 font-semibold mb-6">User: ...</p>

            <div id="fav-modal-list" class="flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2">
                <!-- Content loaded here -->
            </div>

            <div id="fav-modal-empty" class="hidden flex flex-col items-center justify-center py-10 text-gray-500">
                <svg class="w-12 h-12 mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                <p>No favorites saved.</p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyApFbiZsRv8p-w6vbdc8Iv_DtWld9POB6k",
            authDomain: "softweres-a65a3.firebaseapp.com",
            databaseURL: "https://softweres-a65a3-default-rtdb.firebaseio.com",
            projectId: "softweres-a65a3",
            storageBucket: "softweres-a65a3.firebasestorage.app",
            messagingSenderId: "1022515432242",
            appId: "1:1022515432242:web:33376a8e48a8035639e52b",
            measurementId: "G-0DKL94BL4H"
        };

        // Initialize Firebase (Compat - Realtime Database)
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Config 1: For Website Users (Secondary App)
        const userAppConfig = {
            apiKey: "AIzaSyBxSUFriKNThF-_HTJPz5atQ8RPSKxo2jA",
            authDomain: "softweres-for-users-sign-up.firebaseapp.com",
            databaseURL: "https://softweres-for-users-sign-up-default-rtdb.firebaseio.com",
            projectId: "softweres-for-users-sign-up",
            storageBucket: "softweres-for-users-sign-up.firebasestorage.app",
            messagingSenderId: "181761044460",
            appId: "1:181761044460:web:adf132def2804867a11ac9",
            measurementId: "G-QKHKM40RPY"
        };

        // Initialize Secondary App for Website Users
        const userApp = firebase.initializeApp(userAppConfig, 'userApp');
        const userDb = userApp.database();

        let currentCollection = '';
        let items = [];

        // ==================== Toast Notifications ====================
        window.showToast = (message, title = 'Notification', type = 'info') => {
            const container = document.getElementById('toast-container');
            if (!container) return; // Should exist

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            let iconSvg = '';
            if (type === 'success') {
                iconSvg = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                if (!title || title === 'Notification') title = 'Success';
            } else if (type === 'error') {
                iconSvg = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                if (!title || title === 'Notification') title = 'Error';
            } else {
                iconSvg = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            }

            toast.innerHTML = `
                <div class="toast-icon">${iconSvg}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <div class="toast-close" onclick="this.parentElement.remove()">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </div>
            `;

            container.appendChild(toast);

            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.classList.add('toast-hiding');
                toast.addEventListener('animationend', () => {
                    toast.remove();
                });
            }, 4000);
        };

        // ==================== Custom Modal Functions ====================
        function showAlert(message, title = 'Notice', type = 'info') {
            return new Promise((resolve) => {
                const modal = document.getElementById('custom-alert-modal');
                const titleEl = modal.querySelector('.modal-title');
                const messageEl = modal.querySelector('.modal-message');
                const okBtn = modal.querySelector('.modal-btn-primary');
                const icon = modal.querySelector('.modal-icon');

                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;

                // Set icon based on type
                if (type === 'success') {
                    icon.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                    icon.style.borderColor = 'rgba(34, 197, 94, 0.5)';
                    icon.style.background = 'linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.2))';
                    icon.querySelector('svg').style.color = '#86efac';
                } else if (type === 'error') {
                    icon.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                    icon.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                    icon.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2))';
                    icon.querySelector('svg').style.color = '#fca5a5';
                } else {
                    icon.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                    icon.style.borderColor = 'rgba(99, 102, 241, 0.5)';
                    icon.style.background = 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2))';
                    icon.querySelector('svg').style.color = '#a5b4fc';
                }

                // Show modal
                modal.classList.remove('hidden');

                // Handle OK button
                const handleOk = () => {
                    modal.classList.add('hidden');
                    okBtn.removeEventListener('click', handleOk);
                    resolve(true);
                };

                okBtn.addEventListener('click', handleOk);
            });
        }

        function showConfirm(message, title = 'Confirm') {
            return new Promise((resolve) => {
                const modal = document.getElementById('custom-confirm-modal');
                const titleEl = modal.querySelector('.modal-title');
                const messageEl = modal.querySelector('.modal-message');
                const confirmBtn = modal.querySelector('.modal-btn-primary');
                const cancelBtn = modal.querySelector('.modal-btn-secondary');

                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;

                // Show modal
                modal.classList.remove('hidden');

                // Handle buttons
                const handleConfirm = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    modal.classList.add('hidden');
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }

        // ==================== Header Role Update ====================
        function updateHeaderRole() {
            const roleBadge = document.getElementById('header-role-badge');
            const roleText = document.getElementById('role-text');

            if (!roleBadge || !roleText) return;

            if (currentUser) {
                // Set role text
                if (currentUser.role === 'admin') {
                    roleText.textContent = 'ADMIN';
                } else {
                    roleText.textContent = 'SUB-ADMIN';
                }

                // Show with fade-in animation
                roleBadge.classList.remove('hidden');
            } else {
                roleBadge.classList.add('hidden');
            }
        }

        // Auth Logic
        const loginScreen = document.getElementById('login-screen');
        const adminDashboard = document.getElementById('admin-dashboard');
        const loginForm = document.getElementById('login-form');
        let currentUser = null; // Stores current user object (whether Admin or Sub-Admin)

        // Check for existing session (Sub-Admin or Super Admin)
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Super Admin
                currentUser = { role: 'admin', email: user.email, allowedSections: 'all' };
                handleLoginSuccess();
            } else {
                // Check for sub-admin session
                const sessionUser = sessionStorage.getItem('subAdminUser');
                if (sessionUser) {
                    currentUser = JSON.parse(sessionUser);
                    handleLoginSuccess();
                } else {
                    showLoginScreen();
                }
            }
        });

        function handleLoginSuccess() {
            loginScreen.classList.add('hidden');
            adminDashboard.classList.remove('hidden');

            // Update Header Role Badge
            updateHeaderRole();

            // Apply sidebar permissions if sub-admin
            if (currentUser && currentUser.role !== 'admin') {
                applyPermissions(currentUser);

                // --- Real-Time Update Listener ---
                const userRef = db.ref(`users/${currentUser.id}`);
                userRef.on('value', (snapshot) => {
                    const updatedUser = snapshot.val();

                    // 1. Check if user still exists
                    if (!updatedUser) {
                        showAlert('Your account has been deleted by an administrator.', 'Account Deleted', 'error').then(() => {
                            document.getElementById('logout-btn').click();
                        });
                        return;
                    }

                    // 2. Check Ban Status
                    if (updatedUser.isBanned) {
                        showAlert('Your account has been banned by an administrator.', 'Account Banned', 'error').then(() => {
                            document.getElementById('logout-btn').click();
                        });
                        return;
                    }

                    // 3. Update Permissions
                    // Compare new sections with old to see if valid

                    // Update Local Session
                    currentUser.allowedSections = updatedUser.allowedSections || [];
                    currentUser.name = updatedUser.name;
                    currentUser.email = updatedUser.email;

                    // Update Session Storage
                    sessionStorage.setItem('subAdminUser', JSON.stringify(currentUser));

                    // Re-apply Visual Permissions
                    applyPermissions(currentUser);

                    // 4. Validate Current Tab
                    // If we are currently viewing a section that is now revoked, redirect to dashboard
                    if (currentCollection && currentCollection !== 'dashboard' && !currentUser.allowedSections.includes(currentCollection)) {
                        alert('Your access to this section has been revoked.');
                        switchTab('dashboard');
                    }
                });
            }

            // If we are already on a tab, reload it, otherwise go to dashboard
            const currentTab = currentCollection || 'dashboard';
            switchTab(currentTab);

            // Setup real-time listeners for sub-admins
            if (currentUser && currentUser.role === 'sub-admin') {
                setupRealtimeListeners();
            }
        }

        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
            currentUser = null;
        }

        // Apply visual permissions to sidebar
        function applyPermissions(user) {
            if (!user.allowedSections) return;
            const allowed = user.allowedSections; // Array of tab names

            document.querySelectorAll('.sidebar-link').forEach(link => {
                const tab = link.dataset.tab;
                if (tab === 'dashboard') return; // Always allow dashboard
                if (tab === 'userMessages') {
                    // Only allow messages if explicitly in sections (or maybe restricted?)
                    // For now, let's treat it as a section
                }

                if (!allowed.includes(tab)) {
                    link.classList.add('hidden');
                } else {
                    link.classList.remove('hidden');
                }
                if (!allowed.includes(tab)) {
                    link.classList.add('hidden');
                } else {
                    link.classList.remove('hidden');
                }
            });
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errEl = document.getElementById('login-error');
            errEl.classList.add('hidden');

            // 1. Try Firebase Auth (Super Admin)
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    // Success handled by onAuthStateChanged
                })
                .catch((firebaseError) => {
                    // 2. If blocked/failed, Try Sub-Admin Database Auth
                    console.log('Firebase auth failed, checking sub-admin DB...', firebaseError.code);

                    db.ref('users').orderByChild('email').equalTo(email).once('value')
                        .then((snapshot) => {
                            let foundUser = null;
                            if (snapshot.exists()) {
                                snapshot.forEach(child => {
                                    const u = child.val();
                                    // Simple password check (In production use hashing)
                                    if (u.password === password) {
                                        foundUser = { id: child.key, ...u };
                                    }
                                });
                            }

                            if (foundUser) {
                                if (foundUser.isBanned) {
                                    errEl.textContent = 'Account is banned by administrator.';
                                    errEl.classList.remove('hidden');
                                    return;
                                }
                                // Success: Set Session
                                const sessionData = {
                                    role: 'sub-admin',
                                    id: foundUser.id,
                                    email: foundUser.email,
                                    name: foundUser.name,
                                    allowedSections: foundUser.allowedSections || []
                                };
                                sessionStorage.setItem('subAdminUser', JSON.stringify(sessionData));
                                currentUser = sessionData;
                                handleLoginSuccess();
                            } else {
                                // Neither found
                                errEl.textContent = 'Invalid email or password.';
                                errEl.classList.remove('hidden');
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            errEl.textContent = 'Login Error: ' + err.message;
                            errEl.classList.remove('hidden');
                        });
                });
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            // Clean up real-time listeners
            removeRealtimeListeners();

            // Clear Firebase Auth
            auth.signOut().then(() => {
                console.log('Signed out from Firebase');
            }).catch(e => console.error(e));

            // Clear Sub-Admin Session
            sessionStorage.removeItem('subAdminUser');
            currentUser = null;

            // Force Reload/UI Reset
            window.location.reload();
        });

        // Navigation
        window.switchTab = async (tabName) => {
            // Check if section is disabled (only for sub-admins)
            const isSubAdmin = currentUser && currentUser.role === 'sub-admin';
            const isMainAdmin = !isSubAdmin; // Main admin or Firebase auth user

            // Load visibility settings if not already loaded
            if (Object.keys(sectionVisibility).length === 0 && tabName !== 'dashboard' && tabName !== 'siteSettings' && tabName !== 'imageAssets') {
                try {
                    const visibilitySnapshot = await db.ref('settings/sectionVisibility').once('value');
                    sectionVisibility = visibilitySnapshot.exists() ? visibilitySnapshot.val() : {};
                } catch (error) {
                    console.error('Error loading visibility settings:', error);
                }
            }

            // Check if section is disabled
            const isSectionDisabled = sectionVisibility[tabName] === false;

            // If sub-admin trying to access disabled section, show maintenance view
            if (isSubAdmin && isSectionDisabled && tabName !== 'dashboard') {
                showDisabledSectionView(tabName);
                return;
            }

            currentCollection = tabName;
            document.querySelectorAll('.sidebar-link').forEach(btn => {
                if (btn.dataset.tab === tabName) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            const pageTitle = {
                'dashboard': 'Dashboard',
                'easyWorkflow': 'Easy Workflow',
                'adobeSoftware': 'Adobe Software',
                'plugins': 'Plugins',
                'scripts': 'Scripts',
                'assets': 'Assets',
                'utilities': 'Utilities',
                'simplePluginsList': '100+ Plugins List',
                'siteSettings': 'Site Settings',
                'imageAssets': 'Image Assets',
                'userMessages': 'User Messages',
                'websiteUsers': 'Website Users',
                'websiteUsers': 'Website Users',
                'courses': 'Courses',
                'banners': 'Banner Management',
                'brokenLinks': 'Broken Link Reports'
            };

            const titleEl = document.getElementById('page-title');

            // Use custom section name if available, otherwise use default
            let displayTitle = pageTitle[tabName] || 'Dashboard';
            if (window.customSectionNames && window.customSectionNames[tabName]) {
                displayTitle = window.customSectionNames[tabName];
            }

            titleEl.textContent = displayTitle;

            // Handle button visibility & Sections
            const addBtn = document.getElementById('add-item-btn-container');
            const bulkBtn = document.getElementById('bulk-import-btn-container');
            const deleteBtn = document.getElementById('delete-all-btn-container');
            const searchContainer = document.getElementById('search-bar-container');

            const settingForm = document.getElementById('settings-container');

            const userMessagesContainer = document.getElementById('user-messages-container');
            const websiteUsersContainer = document.getElementById('website-users-container');
            const imageAssetsContainer = document.getElementById('image-assets-container');
            const dashboardContainer = document.getElementById('dashboard-container');
            const bannersContainer = document.getElementById('banners-container');
            const brokenLinksContainer = document.getElementById('broken-links-container');
            const itemsGrid = document.getElementById('items-grid');

            // Reset Search
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';

            // Hide everything first
            addBtn.classList.add('hidden');
            if (bulkBtn) bulkBtn.classList.add('hidden');
            if (deleteBtn) deleteBtn.classList.add('hidden');
            if (searchContainer) searchContainer.classList.add('hidden');

            settingForm.classList.add('hidden');

            if (userMessagesContainer) userMessagesContainer.classList.add('hidden');
            if (websiteUsersContainer) websiteUsersContainer.classList.add('hidden');
            if (imageAssetsContainer) imageAssetsContainer.classList.add('hidden');
            if (dashboardContainer) dashboardContainer.classList.add('hidden');
            if (bannersContainer) bannersContainer.classList.add('hidden');
            if (brokenLinksContainer) brokenLinksContainer.classList.add('hidden');
            itemsGrid.classList.add('hidden');

            if (tabName === 'dashboard') {
                if (dashboardContainer) dashboardContainer.classList.remove('hidden');
                loadDashboard();
            } else if (tabName === 'siteSettings') {
                settingForm.classList.remove('hidden');
                loadSettings();

            } else if (tabName === 'userMessages') {
                if (userMessagesContainer) userMessagesContainer.classList.remove('hidden');
                loadUserMessages();
            } else if (tabName === 'websiteUsers') {
                if (websiteUsersContainer) websiteUsersContainer.classList.remove('hidden');
                loadWebsiteUsers();
            } else if (tabName === 'imageAssets') {
                if (imageAssetsContainer) imageAssetsContainer.classList.remove('hidden');
                loadRegisteredAssets();
            } else if (tabName === 'banners') {
                if (bannersContainer) bannersContainer.classList.remove('hidden');
                initBanners(); // Ensure banners are loaded/refreshed
            } else if (tabName === 'brokenLinks') {
                if (brokenLinksContainer) brokenLinksContainer.classList.remove('hidden');
                loadBrokenLinkReports();
            } else {
                // Normal Collections
                addBtn.classList.remove('hidden');
                if (searchContainer) searchContainer.classList.remove('hidden');
                itemsGrid.classList.remove('hidden');

                if (bulkBtn) {
                    if (tabName === 'simplePluginsList') {
                        bulkBtn.classList.remove('hidden');
                        if (deleteBtn) deleteBtn.classList.remove('hidden');
                    }
                }
                loadItems(tabName);
            }
        };

        // Show disabled section maintenance view
        function showDisabledSectionView(tabName) {
            currentCollection = tabName;

            // Update active state
            document.querySelectorAll('.sidebar-link').forEach(btn => {
                if (btn.dataset.tab === tabName) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            const titleEl = document.getElementById('page-title');
            const sectionName = sectionMetadata[tabName]?.name || tabName;
            titleEl.textContent = sectionName;

            // Hide all containers
            const addBtn = document.getElementById('add-item-btn-container');
            const bulkBtn = document.getElementById('bulk-import-btn-container');
            const deleteBtn = document.getElementById('delete-all-btn-container');
            const searchContainer = document.getElementById('search-bar-container');
            const settingForm = document.getElementById('settings-container');

            const userMessagesContainer = document.getElementById('user-messages-container');
            const imageAssetsContainer = document.getElementById('image-assets-container');
            const dashboardContainer = document.getElementById('dashboard-container');
            const itemsGrid = document.getElementById('items-grid');

            addBtn.classList.add('hidden');
            if (bulkBtn) bulkBtn.classList.add('hidden');
            if (deleteBtn) deleteBtn.classList.add('hidden');
            if (searchContainer) searchContainer.classList.add('hidden');
            settingForm.classList.add('hidden');

            if (userMessagesContainer) userMessagesContainer.classList.add('hidden');
            if (imageAssetsContainer) imageAssetsContainer.classList.add('hidden');
            if (dashboardContainer) dashboardContainer.classList.add('hidden');

            // Show maintenance message in items grid
            itemsGrid.classList.remove('hidden');
            itemsGrid.innerHTML = `
                <div class="col-span-full flex items-center justify-center min-h-[400px]">
                    <div class="text-center max-w-md">
                        <div class="mb-6">
                            <svg class="w-24 h-24 mx-auto text-yellow-500/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-3"> Section Temporarily Disabled</h3>
                        <p class="text-gray-400 mb-2">The administrator has disabled this section.</p>
                        <p class="text-gray-500 text-sm">Please check back later or contact the main administrator.</p>
                    </div>
                </div>
            `;
        }

        window.filterItems = (query) => {
            if (!items) return;
            const lowerQuery = query.toLowerCase();
            const filtered = items.filter(item =>
                (item.Title && item.Title.toLowerCase().includes(lowerQuery)) ||
                (item.Description && item.Description.toLowerCase().includes(lowerQuery))
            );
            renderItems(filtered);
        };

        // Dashboard Logic
        // Dashboard Logic
        async function loadDashboard() {
            const statsContainer = document.getElementById('dashboard-stats');
            statsContainer.innerHTML = '<div class="col-span-full text-center py-12"><div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-indigo-500"></div><p class="text-gray-400 mt-4">Loading dashboard...</p></div>';

            try {
                // ===== PERMISSION CHECKING =====
                let isSuperAdmin = true;
                let accessibleSections = [];

                try {
                    const currentUser = firebase.auth().currentUser;
                    if (currentUser) {
                        const permSnapshot = await db.ref(`adminPermissions/${currentUser.uid}`).once('value');
                        const userPermissions = permSnapshot.val();

                        if (userPermissions) {
                            isSuperAdmin = userPermissions.role === 'superAdmin' || userPermissions.isSuperAdmin === true;
                            accessibleSections = userPermissions.accessibleSections || [];
                        }
                    }
                } catch (permError) {
                    console.warn('Could not fetch permissions, defaulting to super admin:', permError);
                }

                // 1. Define Collections to Fetch
                const allContentCollections = [
                    { name: 'adobeSoftware', label: 'Adobe Software', icon: '', color: 'from-purple-600 to-pink-600' },
                    { name: 'plugins', label: 'Plugins', icon: '', color: 'from-blue-600 to-cyan-600' },
                    { name: 'scripts', label: 'Scripts', icon: '', color: 'from-green-600 to-emerald-600' },
                    { name: 'assets', label: 'Assets', icon: '', color: 'from-orange-600 to-amber-600' },
                    { name: 'utilities', label: 'Utilities', icon: '', color: 'from-indigo-600 to-violet-600' },
                    { name: 'simplePluginsList', label: '100+ Plugins', icon: '', color: 'from-teal-600 to-cyan-600' }
                ];

                const allSpecialCollections = [
                    { name: 'courses', label: 'Courses', icon: '', color: 'from-emerald-500 to-teal-500', route: 'courses' },
                    { name: 'banners', label: 'Active Banners', icon: '', color: 'from-fuchsia-500 to-purple-600', route: 'banners' },
                    { name: 'brokenLinkReports', label: 'Broken Links', icon: '', color: 'from-red-500 to-orange-500', route: 'brokenLinks' },
                    { name: 'userMessages', label: 'User Messages', icon: '', color: 'from-rose-500 to-pink-600', route: 'userMessages' }
                ];

                // ===== FILTER BASED ON PERMISSIONS =====
                const contentCollections = isSuperAdmin
                    ? allContentCollections
                    : allContentCollections.filter(col => accessibleSections.includes(col.name));

                const specialCollections = isSuperAdmin
                    ? allSpecialCollections
                    : allSpecialCollections.filter(col => accessibleSections.includes(col.name));

                // Store for sidebar filtering
                window.userAccessibleSections = isSuperAdmin ? 'all' : accessibleSections;

                // 2. Fetch Data
                const stats = {};

                // Fetch Main DB Content
                const contentPromises = contentCollections.map(async (col) => {
                    const snap = await db.ref(col.name).once('value');
                    stats[col.name] = snap.numChildren();
                });

                // Fetch Special Collections
                const specialPromises = specialCollections.map(async (col) => {
                    const snap = await db.ref(col.name).once('value');
                    if (col.name === 'userMessages') {
                        // Count unread
                        let unread = 0;
                        snap.forEach(c => { if (!c.val().read) unread++; });
                        stats[col.name] = unread;
                        stats[col.name + '_total'] = snap.numChildren();
                    } else if (col.name === 'banners') {
                        // Count active
                        let active = 0;
                        snap.forEach(c => { if (c.val().active !== false) active++; }); // Assuming active true by default or explicit check
                        stats[col.name] = active;
                    } else {
                        stats[col.name] = snap.numChildren();
                    }
                });

                // Fetch Website Users (Secondary DB)
                const userPromise = userApp.database().ref('users').once('value').then(snap => {
                    stats['websiteUsers'] = snap.numChildren();
                }).catch(err => {
                    console.error('Error fetching website users:', err);
                    stats['websiteUsers'] = 0;
                });

                await Promise.all([...contentPromises, ...specialPromises, userPromise]);

                // 3. Render Dashboard
                statsContainer.innerHTML = '';
                statsContainer.className = 'flex flex-col gap-8';

                // --- Row 1: Vital Stats (Users, Messages, Reports) ---
                const vitalSection = document.createElement('div');
                vitalSection.innerHTML = '<h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>Vital Statistics</h3>';
                const vitalGrid = document.createElement('div');
                vitalGrid.className = 'grid grid-cols-1 md:grid-cols-3 gap-6';

                // Website Users Card
                vitalGrid.appendChild(createStatCard({
                    label: 'Registered Users',
                    count: stats['websiteUsers'],
                    icon: '',
                    color: 'from-amber-400 to-orange-500',
                    subtext: 'Active Accounts',
                    onClick: () => switchTab('websiteUsers')
                }));

                // Messages Card
                vitalGrid.appendChild(createStatCard({
                    label: 'Unread Messages',
                    count: stats['userMessages'],
                    icon: '',
                    color: 'from-rose-400 to-pink-500',
                    subtext: `Total: ${stats['userMessages_total'] || 0}`,
                    onClick: () => switchTab('userMessages')
                }));

                // Broken Links Card
                vitalGrid.appendChild(createStatCard({
                    label: 'Broken Reports',
                    count: stats['brokenLinkReports'],
                    icon: '',
                    color: 'from-red-500 to-orange-600',
                    subtext: 'Action Required',
                    onClick: () => switchTab('brokenLinks')
                }));

                vitalSection.appendChild(vitalGrid);
                statsContainer.appendChild(vitalSection);


                // --- Row 2: Content Overview (Banners, Courses, Total Assets) ---
                const totalAssets = contentCollections.reduce((sum, col) => sum + (stats[col.name] || 0), 0)
                    + (stats['banners'] || 0)
                    + (stats['courses'] || 0);

                const overviewSection = document.createElement('div');
                overviewSection.innerHTML = '<h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2 mt-2"><svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>Content Overview</h3>';
                const overviewGrid = document.createElement('div');
                overviewGrid.className = 'grid grid-cols-1 md:grid-cols-3 gap-6';

                // Total Assets Card (Hero Style)
                overviewGrid.appendChild(createStatCard({
                    label: 'Total Resources',
                    count: totalAssets,
                    icon: '',
                    color: 'from-indigo-400 to-violet-600',
                    subtext: 'Across all categories',
                    isHero: true
                }));

                // Active Banners
                overviewGrid.appendChild(createStatCard({
                    label: 'Active Banners',
                    count: stats['banners'],
                    icon: '',
                    color: 'from-fuchsia-500 to-purple-600',
                    subtext: 'Homepage Slides',
                    onClick: () => switchTab('banners')
                }));

                // Courses
                overviewGrid.appendChild(createStatCard({
                    label: 'Courses',
                    count: stats['courses'],
                    icon: '',
                    color: 'from-emerald-400 to-teal-500',
                    subtext: 'Available Courses',
                    onClick: () => switchTab('courses')
                }));

                overviewSection.appendChild(overviewGrid);
                statsContainer.appendChild(overviewSection);


                // --- Row 3: Category Detail Grid ---
                const detailSection = document.createElement('div');
                detailSection.innerHTML = '<h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2 mt-2"><svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/></svg>Category Details</h3>';
                const detailGrid = document.createElement('div');
                detailGrid.className = 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4';

                contentCollections.forEach(col => {
                    const card = createStatCard({
                        label: col.label,
                        count: stats[col.name],
                        icon: col.icon,
                        color: col.color,
                        compact: true,
                        onClick: () => switchTab(col.name)
                    });
                    detailGrid.appendChild(card);
                });

                detailSection.appendChild(detailGrid);
                statsContainer.appendChild(detailSection);

                // ===== FILTER SIDEBAR BASED ON PERMISSIONS =====
                filterSidebarByPermissions();

            } catch (error) {
                console.error('Error loading dashboard:', error);
                statsContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-red-400">Error loading dashboard statistics</p></div>';
            }
        }

        // Filter Sidebar Based on Permissions
        function filterSidebarByPermissions() {
            const accessibleSections = window.userAccessibleSections;

            // If super admin, show all
            if (accessibleSections === 'all') return;

            // Map of data-tab values to section names
            const tabToSection = {
                'adobeSoftware': 'adobeSoftware',
                'plugins': 'plugins',
                'scripts': 'scripts',
                'assets': 'assets',
                'utilities': 'utilities',
                'courses': 'courses',
                'simplePluginsList': 'simplePluginsList',
                'banners': 'banners',
                'brokenLinks': 'brokenLinkReports',
                'userMessages': 'userMessages',
                'websiteUsers': 'websiteUsers',
                'imageAssets': 'imageAssets',
                'siteSettings': 'siteSettings'
            };

            // Get all sidebar links
            const sidebarLinks = document.querySelectorAll('.sidebar-link[data-tab]');

            sidebarLinks.forEach(link => {
                const tab = link.getAttribute('data-tab');
                const sectionName = tabToSection[tab];

                // Skip dashboard - always visible
                if (tab === 'dashboard') return;

                // Check if user has access
                const hasAccess = accessibleSections.includes(sectionName);

                if (!hasAccess) {
                    // Hide the link
                    link.style.display = 'none';
                }
            });
        }

        function createStatCard({ label, count, icon, color, onClick, subtext, isHero, compact }) {
            const card = document.createElement('div');
            card.className = `glass-card relative group cursor-pointer hover:bg-white/5 transition-all duration-300 border border-white/5 hover:border-indigo-500/30 overflow-hidden ${compact ? 'p-4' : 'p-6'}`;

            if (isHero) {
                card.className += ' bg-gradient-to-br from-indigo-900/40 to-slate-900/40';
            }

            if (onClick) card.onclick = onClick;

            // Watermark Icon
            const watermark = `
                <div class="absolute -right-4 -bottom-4 text-[5rem] opacity-[0.03] group-hover:opacity-[0.08] group-hover:scale-110 transition-all duration-500 pointer-events-none select-none">
                    ${icon}
                </div>
            `;

            card.innerHTML = `
                ${watermark}
                <div class="flex flex-col h-full justify-between relative z-10">
                    <div class="flex justify-between items-start mb-2">
                        <div class="p-2 rounded-lg bg-white/5 text-2xl shadow-inner">${icon}</div>
                         ${!compact ? `
                        <div class="text-xs text-gray-500 group-hover:text-indigo-400 transition-colors flex items-center gap-1">
                            View 
                            <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </div>` : ''}
                    </div>
                    
                    <div>
                        <div class="${compact ? 'text-2xl' : 'text-4xl'} font-black bg-gradient-to-r ${color} bg-clip-text text-transparent">${count}</div>
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mt-1 truncate" title="${label}">${label}</div>
                        ${subtext ? `<div class="text-[10px] text-gray-600 mt-1 truncate">${subtext}</div>` : ''}
                    </div>
                </div>
            `;

            return card;
        }



        // DUPLICATE LEGACY LISTENER REMOVED - See newer version around line 3673
        /*
        document.getElementById('easy-workflow-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('ew-id').value;
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Saving...';
            btn.disabled = true;

            const data = {
                Title: document.getElementById('ew-title').value,
                Description: document.getElementById('ew-description').value,
                ImageURL: document.getElementById('ew-image').value,
                DownloadLink: document.getElementById('ew-link').value
            };

            try {
                if (id) {
                    await db.ref(`easyWorkflow/${id}`).update(data);
                } else {
                    // If no item exists, create one
                    await db.ref('easyWorkflow').push(data);
                }
                await showAlert('Easy Workflow updated successfully!', 'Success', 'success');
            } catch (error) {
                console.error(error);
                await showAlert('Error updating: ' + error.message, 'Error', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });
        */

        function loadItems(collectionName) {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('items-grid');
            loading.classList.remove('hidden');
            grid.innerHTML = '';

            // Realtime Database Fetch
            db.ref(collectionName).once('value')
                .then((snapshot) => {
                    items = [];
                    snapshot.forEach((childSnapshot) => {
                        items.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });

                    if (items.length === 0) {
                        grid.innerHTML = '<p class="col-span-full text-center text-gray-500 py-10">No items yet. Click "Add New" to create one.</p>';
                    } else {
                        renderItems(items);
                    }
                })
                .catch((error) => {
                    console.error("Error loading items:", error);
                    grid.innerHTML = '<p class="col-span-full text-center text-red-500 py-10">Error loading items. Check console.</p>';
                })
                .finally(() => {
                    loading.classList.add('hidden');
                });
        }

        function renderItems(data) {
            const grid = document.getElementById('items-grid');
            grid.innerHTML = '';

            if (currentCollection === 'simplePluginsList') {
                // Table View for Simple Plugins List
                if (data.length === 0) {
                    grid.innerHTML = '<p class="text-gray-400 text-center w-full py-10">No items yet. Click "Add New" or "Bulk Import".</p>';
                    return;
                }

                const table = document.createElement('div');
                table.className = 'w-full overflow-hidden rounded-lg border border-gray-700';
                table.innerHTML = `
                    <table class="w-full text-left text-sm text-gray-400">
                        <thead class="bg-gray-800 text-gray-200 uppercase font-bold">
                            <tr>
                                <th class="px-6 py-3">Title</th>
                                <th class="px-6 py-3">Download Link</th>
                                <th class="px-6 py-3 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            ${data.map(item => `
                                <tr class="hover:bg-gray-800/50 transition-colors">
                                    <td class="px-6 py-4 font-medium text-white">${item.Title || 'Untitled'}</td>
                                    <td class="px-6 py-4 text-indigo-400 truncate max-w-xs">
                                        <a href="${item.DownloadLink}" target="_blank" class="hover:underline">${item.DownloadLink || 'No Link'}</a>
                                    </td>
                                    <td class="px-6 py-4 text-right space-x-2">
                                        <button onclick="window.open('${item.DownloadLink}', '_blank')" class="text-indigo-400 hover:text-white">View Link</button>
                                        <button onclick="editItem('${item.id}')" class="text-blue-400 hover:text-white">Edit</button>
                                        <button onclick="deleteItem('${item.id}')" class="text-red-400 hover:text-white">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                grid.appendChild(table);
                grid.classList.remove('grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3', 'gap-6');
                grid.classList.add('block');
            } else {
                // Modified Grid View (Max 5 per row)
                grid.classList.remove('block', 'flex', 'flex-col');
                grid.classList.add('grid', 'grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5', 'gap-4');

                if (data.length === 0) {
                    grid.innerHTML = '<p class="text-gray-400 text-center w-full col-span-3 py-10">No items yet. Click "Add New" to create one.</p>';
                    return;
                }

                data.forEach(item => {
                    const div = document.createElement('div');
                    // Horizontal layout card (Image Left, Text Center, Actions Right)
                    div.className = 'glass-card p-3 flex items-center relative gap-3 group hover:bg-white/5 transition-all text-sm cursor-pointer overflow-hidden';
                    div.onclick = (e) => { if (!e.target.closest('button')) editItem(item.id); };

                    const img = item.ImageURL || item.image || 'https://placehold.co/400x300?text=No+Image';
                    const title = item.Title || item.title || 'Untitled';
                    // Using Versions count or ID substring as subtitle
                    const subtitle = item.Versions ? `${item.Versions.length} Versions` : (item.id.substring(0, 6));

                    div.innerHTML = `
                        <!-- Left: Square Image -->
                        <div class="relative w-12 h-12 flex-shrink-0">
                             <img src="${img}" class="w-full h-full object-cover rounded-md bg-gray-800" onerror="this.src='https://placehold.co/100?text=Err'">
                        </div>

                        <!-- Center: Text Info -->
                        <div class="flex-1 min-w-0 flex flex-col justify-center">
                            <h4 class="font-bold text-white text-base leading-tight truncate" title="${title}">${title}</h4>
                            <p class="text-xs text-gray-500 truncate">${subtitle}</p>
                        </div>
                        
                        <!-- Right: Stacked Actions -->
                        <div class="flex flex-col gap-2 ml-1 flex-shrink-0">
                            <button onclick="event.stopPropagation(); deleteItem('${item.id}')" class="bg-red-500/10 hover:bg-red-500/30 text-red-500 border border-red-500/20 p-1.5 rounded transition-colors" title="Delete">
                                 <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            </button>
                            <button onclick="editItem('${item.id}')" class="bg-indigo-500/10 hover:bg-indigo-500/30 text-indigo-400 border border-indigo-500/20 p-1.5 rounded transition-colors" title="Edit">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                        </div>
                    `;
                    grid.appendChild(div);
                });
            }
        }

        async function loadSettings() {
            try {
                // Show/Hide User Management based on role
                const userMgmtSection = document.getElementById('user-management-section');
                if (currentUser && currentUser.role === 'admin') {
                    if (userMgmtSection) userMgmtSection.classList.remove('hidden');
                    if (typeof loadUsers === 'function') loadUsers();
                } else {
                    if (userMgmtSection) userMgmtSection.classList.add('hidden');
                }

                const snapshot = await db.ref('settings').once('value');
                const settings = snapshot.val() || {};

                // Discord & QR (Combined from both versions)
                const discordInput = document.getElementById('setting-discord');
                if (discordInput) discordInput.value = settings.discordUrl || settings.global?.discordUrl || '';

                const qrInput = document.getElementById('setting-qr');
                if (qrInput) {
                    qrInput.value = settings.qrCodeUrl || settings.global?.qrCodeImageUrl || '';
                    updatePreview(qrInput, 'preview-setting-qr');
                }

                // Load Section Names
                const names = settings.sectionNames || {};
                const sectionNameIds = [
                    'adobeSoftware', 'plugins', 'scripts', 'assets',
                    'utilities', 'courses', 'simplePluginsList'
                ];
                sectionNameIds.forEach(id => {
                    const el = document.getElementById(`section-name-${id}`);
                    if (el) el.value = names[id] || '';
                });

                // Load Site Text
                const text = settings.siteText || {};
                const siteTextIds = [
                    'heroTitle1', 'heroTitle2', 'heroDescription',
                    'pluginsPackTitle', 'pluginsPackDescription',
                    'pluginsListTitle', 'pluginsListDescription',
                    'missingResourceTitle', 'missingResourceDescription'
                ];
                siteTextIds.forEach(id => {
                    const el = document.getElementById(`site-text-${id}`);
                    if (el) el.value = text[id] || '';
                });

                // Load Section Order
                if (typeof loadSectionOrder === 'function') loadSectionOrder();

            } catch (error) {
                console.error("Error loading settings:", error);
            }
        }


        // Update Sidebar Labels with Custom Section Names
        function updateSidebarLabels(sectionNames) {
            const sidebarLinks = {
                'adobeSoftware': document.querySelector('[data-tab="adobeSoftware"] span'),
                'plugins': document.querySelector('[data-tab="plugins"] span'),
                'scripts': document.querySelector('[data-tab="scripts"] span'),
                'assets': document.querySelector('[data-tab="assets"] span'),
                'utilities': document.querySelector('[data-tab="utilities"] span'),
                'courses': document.querySelector('[data-tab="courses"] span'),
                'simplePluginsList': document.querySelector('[data-tab="simplePluginsList"] span')
            };

            Object.keys(sectionNames).forEach(key => {
                if (sidebarLinks[key] && sectionNames[key]) {
                    sidebarLinks[key].textContent = sectionNames[key];
                }
            });
        }

        // Load Section Names on Page Load
        db.ref("settings/sectionNames").once('value').then((snapshot) => {
            if (snapshot.exists()) {
                window.customSectionNames = snapshot.val();
                updateSidebarLabels(window.customSectionNames);
            }
        }).catch(e => console.error("Error loading section names:", e));

        // --- Site Identity & Links Logic ---
        const settingsForm = document.getElementById('settings-form');
        if (settingsForm) {
            settingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;

                // Loading State
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Saving...';

                const discordUrl = document.getElementById('setting-discord').value;
                const qrCodeImageUrl = document.getElementById('setting-qr').value;

                try {
                    await db.ref("settings/global").set({ discordUrl, qrCodeImageUrl });
                    showToast("Identity Settings Saved!", "Success", "success");
                } catch (err) {
                    console.error("Error saving identity settings:", err);
                    showToast("Error saving settings: " + err.message, "Error", "error");
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            });
        }

        // --- Content Configuration Logic ---
        const contentSettingsForm = document.getElementById('content-settings-form');
        if (contentSettingsForm) {
            contentSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button[type="submit"]');
                const originalContent = btn.innerHTML;

                // Loading State
                btn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Saving...
                `;
                btn.disabled = true;

                // Section Names
                const sectionNames = {
                    adobeSoftware: document.getElementById('section-name-adobeSoftware').value,
                    plugins: document.getElementById('section-name-plugins').value,
                    scripts: document.getElementById('section-name-scripts').value,
                    assets: document.getElementById('section-name-assets').value,
                    utilities: document.getElementById('section-name-utilities').value,
                    courses: document.getElementById('section-name-courses').value,
                    simplePluginsList: document.getElementById('section-name-simplePluginsList').value
                };

                // Site Text
                const siteText = {
                    heroTitle1: document.getElementById('site-text-heroTitle1').value,
                    heroTitle2: document.getElementById('site-text-heroTitle2').value,
                    heroDescription: document.getElementById('site-text-heroDescription').value,
                    pluginsPackTitle: document.getElementById('site-text-pluginsPackTitle').value,
                    pluginsPackDescription: document.getElementById('site-text-pluginsPackDescription').value,
                    pluginsListTitle: document.getElementById('site-text-pluginsListTitle').value,
                    pluginsListDescription: document.getElementById('site-text-pluginsListDescription').value,
                    missingResourceTitle: document.getElementById('site-text-missingResourceTitle').value,
                    missingResourceDescription: document.getElementById('site-text-missingResourceDescription').value
                };

                try {
                    await Promise.all([
                        db.ref('settings/sectionNames').set(sectionNames),
                        db.ref('settings/siteText').set(siteText)
                    ]);

                    // Update global variable if exists
                    if (window.customSectionNames) window.customSectionNames = sectionNames;

                    showToast("Content Configuration Saved!", "Success", "success");

                    // Refresh sidebar labels if function exists
                    if (typeof updateSidebarLabels === 'function') updateSidebarLabels(sectionNames);

                } catch (err) {
                    console.error("Error saving content config:", err);
                    showToast("Error saving configuration: " + err.message, "Error", "error");
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalContent;
                }
            });
        }

        // User Messages Functions
        let allMessages = [];
        let currentFilter = 'all';

        function loadUserMessages() {
            const messagesList = document.getElementById('messages-list');
            const messagesCount = document.getElementById('messages-count');
            const deleteAllBtn = document.getElementById('delete-all-messages-btn');

            messagesList.innerHTML = '<p class="text-gray-400 text-center py-4">Loading messages...</p>';

            db.ref('userMessages').once('value')
                .then((snapshot) => {
                    messagesList.innerHTML = '';
                    allMessages = [];

                    snapshot.forEach((childSnapshot) => {
                        allMessages.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });

                    // Sort by timestamp (newest first)
                    allMessages.sort((a, b) => b.timestamp - a.timestamp);

                    if (allMessages.length === 0) {
                        messagesList.innerHTML = '<div class="text-center py-12"><svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg><p class="text-gray-400 text-lg">No messages yet</p><p class="text-gray-500 text-sm mt-2">User submissions will appear here</p></div>';
                        messagesCount.textContent = '';
                        deleteAllBtn.classList.add('hidden');
                    } else {
                        messagesCount.textContent = allMessages.length;
                        deleteAllBtn.classList.remove('hidden');
                        renderFilteredMessages();
                    }
                })
                .catch((error) => {
                    console.error('Error loading messages:', error);
                    messagesList.innerHTML = '<p class="text-red-400 text-center py-4">Error loading messages.</p>';
                });
        }

        function renderFilteredMessages() {
            const messagesList = document.getElementById('messages-list');
            messagesList.innerHTML = '';

            let filtered = [...allMessages];
            const now = Date.now();
            const oneDayMs = 24 * 60 * 60 * 1000;
            const oneWeekMs = 7 * oneDayMs;

            if (currentFilter === 'today') {
                filtered = allMessages.filter(msg => (now - msg.timestamp) < oneDayMs);
            } else if (currentFilter === 'week') {
                filtered = allMessages.filter(msg => (now - msg.timestamp) < oneWeekMs);
            }

            if (filtered.length === 0) {
                messagesList.innerHTML = '<p class="text-gray-400 text-center py-8">No messages in this time period.</p>';
                return;
            }

            filtered.forEach(msg => {
                const date = new Date(msg.timestamp);
                const now = new Date();
                const isToday = date.toDateString() === now.toDateString();
                const formattedDate = isToday ? date.toLocaleTimeString() : date.toLocaleString();
                const timeAgo = getTimeAgo(msg.timestamp);

                // Truncate message to 2 lines (approximately 100 characters)
                const messagePreview = msg.message && msg.message.length > 100
                    ? msg.message.substring(0, 100) + '...'
                    : msg.message || 'No message content';

                const messageCard = document.createElement('div');
                const readStatusClass = !msg.read ? 'border-green-500 bg-green-500/10' : 'border-gray-700 bg-gray-800/50';
                messageCard.className = `${readStatusClass} border rounded-lg p-4 hover:border-indigo-500/50 transition-all cursor-pointer`;
                messageCard.onclick = () => openMessageModal(msg);
                messageCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <div class="w-8 h-8 rounded-full bg-indigo-600/20 flex items-center justify-center">
                                    <span class="text-indigo-400 font-bold text-sm">${(msg.name || 'A')[0].toUpperCase()}</span>
                                </div>
                                <div>
                                    <h4 class="text-white font-semibold">${msg.name || 'Anonymous'}</h4>
                                    <div class="flex items-center gap-2">
                                        <p class="text-xs text-gray-500">${timeAgo}</p>
                                        ${!msg.read ? '<span class="bg-green-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold">NEW</span>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="event.stopPropagation(); deleteUserMessage('${msg.id}')" 
                            class="text-red-400 hover:text-red-300 hover:bg-red-900/20 transition-all p-2 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                    <div class="pl-10">
                        <p class="text-gray-300 leading-relaxed line-clamp-2">${messagePreview}</p>
                        <p class="text-xs text-indigo-400 mt-2">Click to view full message</p>
                    </div>
                `;
                messagesList.appendChild(messageCard);
            });
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days < 7) return `${days}d ago`;
            return `${Math.floor(days / 7)}w ago`;
        }

        window.filterMessages = (filter) => {
            currentFilter = filter;

            // Update button states
            document.querySelectorAll('.message-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-800', 'text-gray-400');
            });
            event.target.classList.add('active', 'bg-indigo-600', 'text-white');
            event.target.classList.remove('bg-gray-800', 'text-gray-400');

            renderFilteredMessages();
        };

        window.deleteUserMessage = async (messageId) => {
            if (!await showConfirm('Are you sure you want to delete this message?', 'Delete Message')) return;

            db.ref(`userMessages/${messageId}`).remove()
                .then(() => {
                    loadUserMessages(); // Reload the list
                })
                .catch((error) => {
                    console.error('Error deleting message:', error);
                    showToast('Error deleting message. Please try again.', 'Error', 'error');
                });
        };

        window.deleteAllMessages = async () => {
            if (!await showConfirm(' WARNING: This will DELETE ALL user messages.\n\nAre you sure? This cannot be undone.', 'Delete All Messages')) return;

            const btn = document.getElementById('delete-all-messages-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Deleting...';
            btn.disabled = true;

            db.ref('userMessages').remove()
                .then(() => {
                    loadUserMessages();
                    showToast('All messages deleted successfully.', 'Success', 'success');
                })
                .catch((error) => {
                    console.error('Error deleting all messages:', error);
                    showToast('Error deleting messages. Please try again.', 'Error', 'error');
                })
                .finally(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
        };

        // --- User Management Logic ---

        // Section Name Mapping
        const sectionNames = {
            'adobeSoftware': 'Adobe Software',
            'plugins': 'Plugins',
            'scripts': 'Scripts & Extensions',
            'assets': 'Assets',
            'utilities': 'Utilities',
            'simplePluginsList': '100+ Plugins List',
            'easyWorkflow': 'Easy Workflow',
            'imageAssets': 'Image Assets',
            'userMessages': 'User Messages',
            'siteSettings': 'Site Settings'
        };

        async function loadUsers() {
            const list = document.getElementById('user-list-body');
            list.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">Loading users...</td></tr>';

            db.ref('users').once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        list.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">No sub-admin users found.</td></tr>';
                        return;
                    }

                    let html = '';
                    snapshot.forEach(child => {
                        const user = child.val();
                        const id = child.key;
                        const isBanned = user.isBanned || false;

                        // Map allowed sections to readable names
                        const sections = (user.allowedSections || []).map(key => sectionNames[key] || key).join(', ');
                        const displaySections = sections.length > 50 ? sections.substring(0, 50) + '...' : (sections || 'None');

                        html += `
                            <tr class="border-b border-gray-700/50 hover:bg-white/5 transition-colors">
                                <td class="p-4 text-white font-medium">${user.name}</td>
                                <td class="p-4 text-gray-400 text-sm">${user.email}</td>
                                <td class="p-4 text-gray-400 text-sm" title="${sections}">${displaySections}</td>
                                <td class="p-4">
                                    <span class="px-2 py-1 rounded text-xs font-bold ${isBanned ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}">
                                        ${isBanned ? 'BANNED' : 'ACTIVE'}
                                    </span>
                                </td>
                                <td class="p-4 text-right space-x-2">
                                    <button onclick="editUser('${id}')" class="text-xs px-2 py-1 bg-indigo-500/20 hover:bg-indigo-500/40 text-indigo-400 rounded transition-colors">
                                        Edit Access
                                    </button>
                                    <button onclick="toggleUserBan('${id}', ${isBanned})" class="text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-white transition-colors">
                                        ${isBanned ? 'Unban' : 'Ban'}
                                    </button>
                                    <button onclick="deleteSubAdmin('${id}')" class="text-xs px-2 py-1 bg-red-500/20 hover:bg-red-500/40 text-red-400 rounded transition-colors">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    list.innerHTML = html;
                })
                .catch(err => {
                    console.error(err);
                    list.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-400">Error loading users.</td></tr>';
                });
        }

        window.toggleUserBan = async (id, currentStatus) => {
            if (!await showConfirm(`Are you sure you want to ${currentStatus ? 'unban' : 'ban'} this user?`, 'Confirm Action')) return;
            db.ref(`users/${id}`).update({ isBanned: !currentStatus })
                .then(() => loadUsers())
                .catch(err => showToast('Error updating user: ' + err.message, 'Error', 'error'));
        };

        window.deleteSubAdmin = async (id) => {
            console.log("Attempting to delete SUB-ADMIN:", id);
            if (!await showConfirm('Are you sure you want to DELETE this SUB-ADMIN permanently?', 'Confirm Delete')) {
                console.log("Deletion cancelled by user.");
                return;
            }

            console.log("User confirmed. Removing from DB path: users/" + id);
            db.ref(`users/${id}`).remove()
                .then(() => {
                    console.log("Database remove() successful.");
                    showToast("Sub-Admin deleted successfully", "Success", "success");
                    loadUsers();
                })
                .catch(err => {
                    console.error("Database remove() failed:", err);
                    alert("FATAL ERROR: Could not delete sub-admin. \n" + err.message);
                    showToast('Error deleting sub-admin: ' + err.message, 'Error', 'error');
                });
        };

        window.editUser = (id) => {
            db.ref(`users/${id}`).once('value').then(snapshot => {
                const user = snapshot.val();
                if (!user) return;

                document.getElementById('edit-user-id').value = id;
                document.getElementById('user-form-title').innerText = 'Edit Sub-Admin Access';
                document.getElementById('new-user-name').value = user.name;
                document.getElementById('new-user-email').value = user.email;
                document.getElementById('new-user-password').value = user.password; // Unsafe usually, but expected here

                // Set Checkboxes
                document.querySelectorAll('input[name="user-sections"]').forEach(cb => {
                    cb.checked = (user.allowedSections || []).includes(cb.value);
                });

                // Update Button
                const btn = document.querySelector('#add-user-form button[type="submit"]');
                btn.innerText = 'Update Sub-Admin';

                // Scroll to form
                document.getElementById('user-management-section').scrollIntoView({ behavior: 'smooth' });
            });
        };

        document.getElementById('add-user-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('edit-user-id').value;
            const name = document.getElementById('new-user-name').value;
            const email = document.getElementById('new-user-email').value;
            const password = document.getElementById('new-user-password').value;

            // Get selected sections
            const selectedSections = [];
            document.querySelectorAll('input[name="user-sections"]:checked').forEach(cb => {
                selectedSections.push(cb.value);
            });

            if (selectedSections.length === 0) {
                showToast('Please select at least one section access.', 'Input Error', 'error');
                return;
            }

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerText = id ? 'Updating...' : 'Creating...';
            btn.disabled = true;

            const promise = id
                ? db.ref(`users/${id}`).update({ name, email, password, allowedSections: selectedSections })
                : db.ref('users').orderByChild('email').equalTo(email).once('value').then(snap => {
                    if (snap.exists()) throw new Error('User with this email already exists.');
                    return db.ref('users').push({
                        name, email, password, allowedSections: selectedSections, isBanned: false, createdAt: Date.now()
                    });
                });

            promise.then(async () => {
                showToast(id ? 'User updated successfully!' : 'User created successfully!', 'Success', 'success');
                document.getElementById('add-user-form').reset();
                document.getElementById('edit-user-id').value = '';
                document.getElementById('user-form-title').innerText = 'Add New Sub-Admin';
                btn.innerText = 'Create Sub-Admin'; // Reset button text
                loadUsers();
            })
                .catch(async (err) => showToast('Error: ' + err.message, 'Error', 'error'))
                .finally(() => {
                    if (btn.innerText !== 'Create Sub-Admin') btn.innerText = originalText;
                    if (!id) btn.innerText = 'Create Sub-Admin'; // Fallback reset
                    btn.disabled = false;
                });
        });

        // Message Modal Functions
        let currentMessageId = null;

        window.openMessageModal = (msg) => {
            currentMessageId = msg.id;
            const modal = document.getElementById('message-detail-modal');

            // Mark as read in database if not already read
            if (!msg.read) {
                db.ref('userMessages/' + msg.id).update({ read: true }).then(() => {
                    // Update UI locally to reflect read status immediately without full reload if preferred,
                    // but for simplicity we'll refresh the counts next time loadDashboard is called or usually relies on real-time listener.
                    // Since we use once(), we should reload dashboard to update the notification count.
                    loadDashboard();
                    loadUserMessages();
                });
            }

            // Populate modal with message data
            document.getElementById('msg-modal-initial').textContent = (msg.name || 'A')[0].toUpperCase();
            document.getElementById('msg-modal-name').textContent = msg.name || 'Anonymous';

            // Show full date and time
            const date = new Date(msg.timestamp);
            const fullDateTime = date.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('msg-modal-date').textContent = fullDateTime;

            document.getElementById('msg-modal-content').textContent = msg.message || 'No message content';

            modal.classList.remove('hidden');
        };

        window.closeMessageModal = () => {
            document.getElementById('message-detail-modal').classList.add('hidden');
            currentMessageId = null;
        };

        window.deleteMessageFromModal = async () => {
            if (!currentMessageId) return;
            if (!await showConfirm('Are you sure you want to delete this message?', 'Delete Message')) return;

            db.ref(`userMessages/${currentMessageId}`).remove()
                .then(() => {
                    closeMessageModal();
                    loadUserMessages();
                })
                .catch((error) => {
                    console.error('Error deleting message:', error);
                    showToast('Error deleting message. Please try again.', 'Error', 'error');
                });
        };

        // Image Assets Management Functions
        function loadRegisteredAssets() {
            const grid = document.getElementById('registered-assets-grid');
            const countEl = document.getElementById('assets-count');
            const hardcodedList = document.getElementById('hardcoded-images-list');
            const hardcodedCount = document.getElementById('hardcoded-count');

            // Display hardcoded images
            hardcodedList.innerHTML = '';
            hardcodedCount.textContent = `${knownImages.length} images`;

            const listContainer = document.createElement('div');
            listContainer.className = 'grid grid-cols-2 md:grid-cols-3 gap-2';

            knownImages.forEach((filename, index) => {
                const item = document.createElement('div');
                item.className = 'flex items-center gap-2 bg-gray-800/50 p-2 rounded text-xs';
                item.innerHTML = `
                    <span class="text-gray-500 font-mono">${index + 1}.</span>
                    <span class="text-gray-300 truncate flex-1" title="${filename}">${filename}</span>
                    <img src="assets/${filename}" class="w-6 h-6 object-cover rounded" onerror="this.style.display='none'">
                `;
                listContainer.appendChild(item);
            });

            hardcodedList.appendChild(listContainer);

            // Display registered assets
            grid.innerHTML = '<p class="col-span-full text-gray-400 text-center py-8">Loading assets...</p>';

            db.ref('registeredAssets').once('value')
                .then((snapshot) => {
                    grid.innerHTML = '';
                    let count = 0;

                    snapshot.forEach((childSnapshot) => {
                        count++;
                        const asset = childSnapshot.val();
                        const assetId = childSnapshot.key;

                        const card = document.createElement('div');
                        card.className = 'glass-card p-3 group hover:bg-white/5 transition-all relative';
                        card.innerHTML = `
                            <div class="aspect-square bg-gray-800 rounded-lg overflow-hidden mb-2">
                                <img src="${asset.path}" alt="${asset.filename}" 
                                    class="w-full h-full object-cover"
                                    onerror="this.src='https://placehold.co/400?text=Error'">
                            </div>
                            <p class="text-white text-xs font-medium truncate mb-1" title="${asset.filename}">${asset.filename}</p>
                            <p class="text-gray-500 text-xs">${new Date(asset.timestamp).toLocaleDateString()}</p>
                            <button onclick="deleteAsset('${assetId}')" 
                                class="absolute top-2 right-2 bg-red-500/80 hover:bg-red-500 text-white p-1.5 rounded-md opacity-0 group-hover:opacity-100 transition-opacity"
                                title="Delete">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        `;
                        grid.appendChild(card);
                    });

                    countEl.textContent = count === 0 ? '0 images' : `${count} image${count > 1 ? 's' : ''}`;

                    if (count === 0) {
                        grid.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <p class="text-gray-400 text-lg">No images registered yet</p>
                                <p class="text-gray-500 text-sm mt-2">Upload images to /assets folder and register them above</p>
                            </div>
                        `;
                    }
                })
                .catch((error) => {
                    console.error('Error loading assets:', error);
                    grid.innerHTML = '<p class="col-span-full text-red-400 text-center py-8">Error loading assets</p>';
                });
        }

        window.deleteAsset = async (assetId) => {
            if (!await showConfirm('Are you sure you want to remove this image from the registry?', 'Remove Asset')) return;

            db.ref(`registeredAssets/${assetId}`).remove()
                .then(() => {
                    loadRegisteredAssets();
                })
                .catch((error) => {
                    console.error('Error deleting asset:', error);
                    showToast('Error deleting asset. Please try again.', 'Error', 'error');
                });
        };

        // Register Asset Form Handler
        document.getElementById('register-asset-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const filenameInput = document.getElementById('asset-filename');
            let filename = filenameInput.value.trim();

            if (!filename) {
                showToast('Please enter a filename', 'Input Required', 'error');
                return;
            }

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Checking...';
            btn.disabled = true;

            try {
                // Check if filename has extension
                const hasExtension = /\.(png|jpg|jpeg|webp|svg|gif)$/i.test(filename);

                let finalFilename = filename;
                let foundExtension = null;

                if (!hasExtension) {
                    // Try common extensions
                    const extensionsToTry = ['png', 'jpg', 'jpeg', 'webp', 'svg'];
                    btn.innerHTML = 'Detecting extension...';

                    for (const ext of extensionsToTry) {
                        const testFilename = `${filename}.${ext}`;
                        const testPath = `assets/${testFilename}`;

                        // Check if image exists
                        const exists = await checkImageExists(testPath);
                        if (exists) {
                            finalFilename = testFilename;
                            foundExtension = ext;
                            break;
                        }
                    }

                    if (!foundExtension) {
                        showToast(`Could not find image "${filename}" with any common extension. Please check filename.`, 'Image Not Found', 'error');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        return;
                    }
                } else {
                    // Verify the image exists
                    const exists = await checkImageExists(`assets/${filename}`);
                    if (!exists) {
                        showToast(`Image "${filename}" not found in /assets. Please upload it first.`, 'Image Not Found', 'error');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        return;
                    }
                }

                btn.innerHTML = 'Registering...';

                // Construct the full path
                const path = `assets/${finalFilename}`;

                // Save to database
                await db.ref('registeredAssets').push({
                    filename: finalFilename,
                    path: path,
                    timestamp: Date.now()
                });

                // Add to knownImages array if not already there
                if (!knownImages.includes(finalFilename)) {
                    knownImages.push(finalFilename);
                    console.log(`Added "${finalFilename}" to knownImages array`);
                }

                filenameInput.value = '';
                loadRegisteredAssets();

                const message = foundExtension
                    ? `Image registered successfully as "${finalFilename}" (auto-detected .${foundExtension})\n\nIt will now appear in the image picker and has been added to the knownImages array.`
                    : `Image "${finalFilename}" registered successfully!\n\nIt will now appear in the image picker and has been added to the knownImages array.`;

                showToast(message, 'Success', 'success');
            } catch (error) {
                console.error('Error registering asset:', error);
                showToast('Error registering asset: ' + error.message, 'Error', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // Sub-Items Global State
        let currentSubItems = [];

        window.toggleSubItemsConfig = () => {
            const hasSubItems = document.getElementById('item-has-sub-items').checked;
            const configDiv = document.getElementById('sub-items-config');
            if (hasSubItems) {
                configDiv.classList.remove('hidden');
            } else {
                configDiv.classList.add('hidden');
            }
        };



        window.deleteSubItem = (id) => {
            window.currentSubItems = window.currentSubItems.filter(item => item.id !== id);
            renderSubItemsList();
        };


        // CRUD Operations
        window.openModal = (reset = true) => {
            const modal = document.getElementById('item-modal');
            const versionsSection = document.getElementById('versions-section');
            const singleLinkSection = document.getElementById('single-link-section');
            const descField = document.getElementById('description-field');
            const imageField = document.getElementById('image-field');
            const subItemsSection = document.getElementById('sub-items-section');

            if (reset) {
                document.getElementById('item-form').reset();
                document.getElementById('item-id').value = '';
                document.getElementById('modal-title').innerText = 'Add Item';
                document.getElementById('versions-container').innerHTML = '';
                document.getElementById('preview-item-image').classList.add('hidden');

                // Reset Sub-Items
                window.currentSubItems = [];
                toggleSubItemsConfig();
                renderSubItemsList();

                if (currentCollection !== 'assets' && currentCollection !== 'simplePluginsList' && currentCollection !== 'courses') {
                    addVersionField();
                }
            }

            // Adjust form based on collection type
            if (currentCollection === 'assets' || currentCollection === 'simplePluginsList' || currentCollection === 'courses') {
                versionsSection.classList.add('hidden');
                singleLinkSection.classList.remove('hidden');
            } else {
                versionsSection.classList.remove('hidden');
                singleLinkSection.classList.add('hidden');
            }

            if (currentCollection === 'simplePluginsList') {
                descField.classList.add('hidden');
                imageField.classList.add('hidden');
            } else {
                descField.classList.remove('hidden');
                imageField.classList.remove('hidden');
            }

            // Show/Hide Sub-Items Section (Only for major collections)
            const allowedCollections = ['adobeSoftware', 'plugins', 'scripts', 'utilities'];
            if (allowedCollections.includes(currentCollection)) {
                subItemsSection.classList.remove('hidden');
            } else {
                subItemsSection.classList.add('hidden');
            }

            // Show download description field for items with download windows
            const downloadDescField = document.getElementById('download-description-field');
            if (currentCollection === 'simplePluginsList' || currentCollection === 'banners') {
                downloadDescField.classList.add('hidden');
            } else {
                downloadDescField.classList.remove('hidden');
            }

            modal.classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('item-modal').classList.add('hidden');
        };

        window.updatePreview = (input, previewId) => {
            const preview = document.getElementById(previewId);
            if (input.value && input.value.match(/\.(jpeg|jpg|gif|png|webp|svg)/i)) {
                preview.src = input.value;
                preview.classList.remove('hidden');
            } else if (input.value) {
                preview.src = input.value;
                preview.classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
            }
            preview.onerror = () => preview.classList.add('hidden');
        };

        window.addVersionField = (name = '', link = '', desc = '') => {
            const container = document.getElementById('versions-container');
            const div = document.createElement('div');
            div.className = 'flex gap-2 items-start bg-gray-800/50 p-2 rounded-lg';

            // For Adobe Software, include description field
            if (currentCollection === 'adobeSoftware') {
                div.innerHTML = `
                    <input type="text" placeholder="Year/Name (e.g. 2024)" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-name" value="${name}" required>
                    <select class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-desc">
                        <option value="">Select Version Type</option>
                        <option value="Stable Version" ${desc === 'Stable Version' ? 'selected' : ''}>Stable Version</option>
                        <option value="Latest Version" ${desc === 'Latest Version' ? 'selected' : ''}>Latest Version</option>
                    </select>
                    <input type="url" placeholder="Download URL" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-link" value="${link}" required>
                    <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300 p-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                `;
            } else {
                div.innerHTML = `
                    <input type="text" placeholder="Version Name (e.g. v2024)" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-name" value="${name}" required>
                    <input type="url" placeholder="Download URL" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-link" value="${link}" required>
                    <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300 p-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                `;
            }
            container.appendChild(div);
        };

        document.getElementById('item-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('item-id').value;
            const title = document.getElementById('item-title').value;
            const description = document.getElementById('item-description').value;
            const image = document.getElementById('item-image').value;
            const downloadLink = document.getElementById('item-download-link').value;

            const versions = [];
            document.querySelectorAll('#versions-container > div').forEach(div => {
                const nameInput = div.querySelector('.version-name');
                const linkInput = div.querySelector('.version-link');
                const descInput = div.querySelector('.version-desc');

                if (nameInput && linkInput && nameInput.value && linkInput.value) {
                    if (currentCollection === 'adobeSoftware') {
                        versions.push({
                            Name: nameInput.value,
                            Description: descInput ? descInput.value : '',
                            Link: linkInput.value
                        });
                    } else {
                        versions.push({
                            Name: nameInput.value,
                            Link: linkInput.value
                        });
                    }
                }
            });

            const downloadDescription = document.getElementById('item-download-description').value;

            let data = { Title: title };

            // Collect Sub-Items Data
            const hasSubItems = document.getElementById('item-has-sub-items').checked;
            if (hasSubItems) {
                data.hasSubItems = true;
                data.subItemsButtonText = document.getElementById('sub-items-btn-text').value;
                data.subItemsPageTitle = document.getElementById('sub-items-page-title').value;
                data.subItemsPageDescription = document.getElementById('sub-items-page-desc').value;
                data.subItems = window.currentSubItems;
            } else {
                data.hasSubItems = false;
                data.subItems = null;
            }

            if (currentCollection === 'simplePluginsList') {
                data.DownloadLink = downloadLink;
            } else if (currentCollection === 'assets' || currentCollection === 'courses') {
                data.Description = description;
                data.DownloadDescription = downloadDescription;
                data.ImageURL = image;
                data.DownloadLink = downloadLink;
            } else {
                data.Description = description;
                data.DownloadDescription = downloadDescription;
                data.ImageURL = image;
                data.Versions = versions;
            }

            // Realtime Database Write
            const ref = id
                ? db.ref(currentCollection + '/' + id).update(data)
                : db.ref(currentCollection).push(data);

            ref.then(() => {
                closeModal();
                loadItems(currentCollection);
                showToast('Item saved successfully!', 'Success', 'success');
            })
                .catch((error) => {
                    console.error("Error saving item:", error);
                    showToast("Error saving item: " + error.message, 'Error', 'error');
                });
        });

        window.editItem = (id) => {
            const item = items.find(i => i.id === id);
            if (!item) return;

            openModal(false);
            document.getElementById('item-id').value = item.id;
            document.getElementById('modal-title').innerText = 'Edit Item';

            document.getElementById('item-title').value = item.Title || '';
            document.getElementById('item-description').value = item.Description || '';
            document.getElementById('item-download-description').value = item.DownloadDescription || '';
            document.getElementById('item-image').value = item.ImageURL || '';
            document.getElementById('item-download-link').value = item.DownloadLink || '';

            // Sub-Items Population
            window.currentSubItems = item.subItems || [];
            document.getElementById('item-has-sub-items').checked = item.hasSubItems || false;
            document.getElementById('sub-items-btn-text').value = item.subItemsButtonText || 'View All Resources';
            document.getElementById('sub-items-page-title').value = item.subItemsPageTitle || '';
            document.getElementById('sub-items-page-desc').value = item.subItemsPageDescription || '';

            toggleSubItemsConfig();
            renderSubItemsList();

            updatePreview(document.getElementById('item-image'), 'preview-item-image');

            const container = document.getElementById('versions-container');
            container.innerHTML = '';

            const itemVersions = item.Versions || [];
            if (itemVersions.length > 0) {
                itemVersions.forEach(v => {
                    addVersionField(v.Name, v.Link, v.Description || '');
                });
            } else if (currentCollection !== 'assets' && currentCollection !== 'simplePluginsList' && currentCollection !== 'courses') {
                addVersionField();
            }
        };

        window.deleteItem = async (id) => {
            if (await showConfirm("Are you sure you want to delete this item?", "Delete Item")) {
                db.ref(currentCollection + '/' + id).remove()
                    .then(() => {
                        loadItems(currentCollection);
                        showToast('Item deleted successfully.', 'Success', 'success');
                    })
                    .catch((error) => {
                        console.error("Error deleting item:", error);
                        showToast("Error deleting item", 'Error', 'error');
                    });
            }
        };

        // Initial list of known images (Updated from actual assets folder)
        const knownImages = [
            '3d-extruder.png', 'Camera3D.png', 'Circle.png', 'EWF.png',
            'JerryFlow_v2.png', 'MT.png', 'Mocha.png', 'QR.png', 'SM.png',
            'STT.png', 'Shifter.png', 'VC-ofpng.png', 'atom_x.jpg',
            'autofill.png', 'cc.png', 'dg.jpg', 'e3d.png', 'excalibur.png',
            'flow.png', 'fxc.png', 'geolayers3.jpg', 'godrays.png', 'gradient8.png',
            'influx.png', 'keyfast.png', 'keystone.jpg', 'labels.png', 'lg.png', 'mb.png',
            'mobar.png', 'motion_bro.png', 'newton-4.png', 'overlord.png',
            'plexus.png', 'reach.png', 'real-glow.png', 'rg-ss.png', 'rg-ts.png', 'rgu.png',
            'rsmb.png', 'sab.png', 'sap.png', 'ss3.png', 'te.png', 'textevo.png',
            'trim-pack.png', 'twxt.png', 'vs.png'
        ];

        // Function to check if an image exists and is loadable
        function checkImageExists(imagePath) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = imagePath;
            });
        }

        // Function to discover all images in assets folder
        async function discoverImages() {
            try {
                // Step 1: Check all known images from the hardcoded list
                const knownImagePaths = await Promise.all(
                    knownImages.map(async (imageName) => {
                        const path = 'assets/' + imageName;
                        const exists = await checkImageExists(path);
                        return exists ? path : null;
                    })
                );

                const validKnownImages = knownImagePaths.filter(path => path !== null);

                // Step 2: Load additional registered images from database
                const snapshot = await db.ref('registeredAssets').once('value');
                const registeredImages = [];

                snapshot.forEach((childSnapshot) => {
                    const asset = childSnapshot.val();
                    if (asset && asset.path) {
                        registeredImages.push(asset.path);
                    }
                });

                // Step 3: Merge and deduplicate
                const allImages = [...new Set([...validKnownImages, ...registeredImages])];

                discoveredImages = allImages;
                return discoveredImages;
            } catch (error) {
                console.error('Error discovering images:', error);
                // Fallback to just checking known images if database fails
                const knownImagePaths = await Promise.all(
                    knownImages.map(async (imageName) => {
                        const path = 'assets/' + imageName;
                        const exists = await checkImageExists(path);
                        return exists ? path : null;
                    })
                );
                discoveredImages = knownImagePaths.filter(path => path !== null);
                return discoveredImages;
            }
        }

        // ==================== Settings Management ====================




        // Render images in the picker grid
        function renderImageGrid(images) {
            const grid = document.getElementById('image-picker-grid');
            grid.innerHTML = '';

            if (images.length === 0) {
                grid.innerHTML = '<p class="col-span-full text-center text-gray-400 py-10">No images found in assets folder.</p>';
                return;
            }

            images.forEach(imagePath => {
                const imageName = imagePath.split('/').pop();
                const div = document.createElement('div');
                div.className = 'cursor-pointer group relative overflow-hidden rounded-lg border-2 border-transparent hover:border-indigo-500 transition-all duration-200 bg-gray-800';
                div.innerHTML = `
                    <img src="${imagePath}" alt="${imageName}"
                         class="w-full h-32 object-cover group-hover:scale-110 transition-transform duration-200"
                         loading="lazy">
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <span class="text-white text-xs font-semibold text-center px-2">${imageName}</span>
                    </div>
                `;
                div.onclick = () => selectImage(imagePath);
                grid.appendChild(div);
            });
        }

        window.openImagePicker = async (inputId) => {
            currentImageInputId = inputId;
            const modal = document.getElementById('image-picker-modal');
            const grid = document.getElementById('image-picker-grid');

            // Show loading state
            grid.innerHTML = '<p class="col-span-full text-center text-gray-400 py-10">Loading images...</p>';
            modal.classList.remove('hidden');

            // Always discover images fresh on open (Auto-refresh)
            await discoverImages();
            renderImageGrid(discoveredImages);
        };

        window.closeImagePicker = () => {
            document.getElementById('image-picker-modal').classList.add('hidden');
        };

        window.selectImage = (imagePath) => {
            const input = document.getElementById(currentImageInputId);
            if (input) {
                input.value = imagePath;
                // Trigger preview update
                const mainPreviews = ['preview-item-image', 'preview-setting-qr', 'preview-ew-image'];
                // Simple logic: try to update matching preview for this input
                // Or just reused updatePreview logic
                if (currentImageInputId === 'item-image') updatePreview(input, 'preview-item-image');
                else if (currentImageInputId === 'setting-qr') updatePreview(input, 'preview-setting-qr');
                else if (currentImageInputId === 'ew-image') updatePreview(input, 'preview-ew-image');
            }
            closeImagePicker();
        };

        // ... Bulk Import Logic ...
        window.openBulkImportModal = () => {
            document.getElementById('bulk-import-modal').classList.remove('hidden');
            document.getElementById('bulk-import-text').value = '';
        };

        window.closeBulkImportModal = () => {
            document.getElementById('bulk-import-modal').classList.add('hidden');
        };

        window.importPlugins = async () => {
            // ... import logic (unchanged) ...
            const text = document.getElementById('bulk-import-text').value;
            if (!text.trim()) { await showAlert('Please enter some text to import.', 'Input Required', 'warning'); return; }

            const lines = text.split('\n');
            let successCount = 0;
            const btn = document.getElementById('import-btn-action');
            const originalText = btn.innerText;
            btn.innerText = 'Importing...'; btn.disabled = true;

            const promises = [];
            for (let line of lines) {
                if (!line.trim()) continue;
                let [title, link] = line.split('|').map(s => s.trim());
                if (!title) continue;
                promises.push(db.ref('simplePluginsList').push({ Title: title, DownloadLink: link || '#' }).then(() => successCount++));
            }
            Promise.all(promises).then(async () => {
                showToast(`Successfully imported ${successCount} plugins!`, 'Import Complete', 'success');
                closeBulkImportModal();
                loadItems('simplePluginsList');
            }).catch(async (err) => { console.error(err); showToast('Error importing plugins.', 'Error', 'error'); })
                .finally(() => { btn.innerText = originalText; btn.disabled = false; });
        };

        // --- Versions Logic Refactoring ---

        window.addVersionField = (name = '', link = '', desc = '', containerId = 'versions-container') => {
            const container = document.getElementById(containerId);
            if (!container) return; // Safety check

            const div = document.createElement('div');
            div.className = 'flex gap-2 items-start bg-gray-800/50 p-2 rounded-lg';

            // For Adobe Software (and potentially Easy Workflow if rich versions needed), include description field
            // But usually only Adobe uses description in versions. Let's assume standard Name/Link for others.
            // UNLESS it's Adobe Software explicitly.

            const isRich = (currentCollection === 'adobeSoftware');

            if (isRich) {
                div.innerHTML = `
                    <input type="text" placeholder="Year/Name" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-name" value="${name}" required>
                    <select class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-desc">
                        <option value="">Select Version Type</option>
                        <option value="Stable Version" ${desc === 'Stable Version' ? 'selected' : ''}>Stable Version</option>
                        <option value="Latest Version" ${desc === 'Latest Version' ? 'selected' : ''}>Latest Version</option>
                    </select>
                    <input type="url" placeholder="Download URL" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-link" value="${link}" required>
                    <button type="button" onclick="const l=this.parentElement.querySelector('.version-link').value; if(l) window.open(l, '_blank'); else alert('No link provided')" class="text-blue-400 hover:text-blue-300 p-1 mr-1" title="View Link">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                    </button>
                    <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300 p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                `;
            } else {
                div.innerHTML = `
                    <input type="text" placeholder="Version Name (e.g. v2024)" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-name" value="${name}" required>
                    <input type="url" placeholder="Download URL" class="flex-1 bg-gray-800 border border-gray-700 rounded p-2 text-white text-sm outline-none version-link" value="${link}" required>
                    <button type="button" onclick="const l=this.parentElement.querySelector('.version-link').value; if(l) window.open(l, '_blank'); else alert('No link provided')" class="text-blue-400 hover:text-blue-300 p-1 mr-1" title="View Link">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                    </button>
                    <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300 p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                `;
            }
            container.appendChild(div);
        };



        // ==================== Section Order Management ====================

        const defaultSectionOrder = [

            'adobeSoftware',
            'plugins',
            'scripts',
            'assets',
            'utilities',
            'courses',
            'simplePluginsList',
            'userMessages'
        ];

        const sectionMetadata = {

            'adobeSoftware': { name: 'Adobe Software', icon: '', color: 'purple' },
            'plugins': { name: 'Plugins', icon: '', color: 'blue' },
            'scripts': { name: 'Scripts & Extensions', icon: '', color: 'green' },
            'assets': { name: 'Assets', icon: '', color: 'orange' },
            'utilities': { name: 'Utilities & Other Software', icon: '', color: 'indigo' },
            'courses': { name: 'Courses', icon: '', color: 'emerald' },
            'simplePluginsList': { name: '100+ Plugins List', icon: '', color: 'teal' },
            'userMessages': { name: 'User Messages', icon: '', color: 'rose' }
        };

        let draggedElement = null;
        let currentSectionOrder = [];
        let sectionVisibility = {}; // Track enabled/disabled state for each section

        // Real-time listener references (for sub-admins)
        let visibilityListener = null;
        let userPermissionsListener = null;

        // Setup real-time listeners for sub-admins
        function setupRealtimeListeners() {
            // Only for sub-admins
            if (!currentUser || currentUser.role !== 'sub-admin') {
                console.log('Skipping real-time listeners (not a sub-admin)');
                return;
            }

            console.log('Setting up real-time listeners for sub-admin:', currentUser.email);

            // Listen to section visibility changes
            db.ref('settings/sectionVisibility').on('value', handleVisibilityChange);

            // Listen to own user permissions
            db.ref(`users/${currentUser.id}`).on('value', handleUserPermissionsChange);
        }

        // Remove real-time listeners
        function removeRealtimeListeners() {
            console.log('Removing real-time listeners');

            db.ref('settings/sectionVisibility').off('value', handleVisibilityChange);

            if (currentUser && currentUser.id) {
                db.ref(`users/${currentUser.id}`).off('value', handleUserPermissionsChange);
            }
        }

        // Handle visibility changes in real-time
        function handleVisibilityChange(snapshot) {
            const newVisibility = snapshot.val() || {};
            console.log('Visibility changed:', newVisibility);

            sectionVisibility = newVisibility; // Update global state

            // If currently viewing a section that was just disabled
            if (currentCollection &&
                currentCollection !== 'dashboard' &&
                currentCollection !== 'siteSettings' &&
                currentCollection !== 'imageAssets' &&
                newVisibility[currentCollection] === false) {

                console.log(`Section ${currentCollection} was disabled by admin`);
                showSyncNotification('This section has been disabled');
                showDisabledSectionView(currentCollection);
            }

            // Note: Sidebar links remain visible
            // Sub-admins will see maintenance screen when clicking disabled sections
        }

        // Handle user permissions changes in real-time
        function handleUserPermissionsChange(snapshot) {
            const updatedUserData = snapshot.val();

            if (!updatedUserData) {
                console.error('User data not found');
                return;
            }

            console.log('User permissions changed:', updatedUserData);

            // Check if banned
            if (updatedUserData.isBanned) {
                showSyncNotification('Your account has been disabled');
                setTimeout(async () => {
                    await showAlert('Your account has been disabled by the administrator.', 'Account Banned', 'error');
                    removeRealtimeListeners();
                    sessionStorage.removeItem('subAdminUser');
                    window.location.reload();
                }, 1000);
                return;
            }

            // Update current user permissions
            const oldAllowedSections = currentUser.allowedSections || [];
            currentUser.allowedSections = updatedUserData.allowedSections || [];

            // Reapply permissions to sidebar
            applyPermissions(currentUser);

            // If current section is now restricted
            if (currentCollection &&
                currentCollection !== 'dashboard' &&
                !currentUser.allowedSections.includes(currentCollection)) {

                showSyncNotification('Access to this section has been revoked');
                setTimeout(() => {
                    alert('Your access to this section has been revoked by the administrator.');
                    switchTab('dashboard');
                }, 1000);
            }
        }

        // Update sidebar for disabled sections
        function updateSidebarForDisabledSections(visibility) {
            // Note: We don't hide sidebar links for disabled sections
            // Instead, when sub-admin clicks on a disabled section,
            // the switchTab function will show the maintenance screen
            // This keeps the UI consistent and lets users see what sections exist

            // The visibility check happens in switchTab() function
            console.log('Sidebar visibility updated (links remain visible)');
        }

        // Show sync notification
        function showSyncNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-indigo-600 text-white px-4 py-3 rounded-lg shadow-lg z-50 animate-fade-in';
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        async function loadSettings() {
            // Load section order
            await loadSectionOrder();

            // Load Auth Settings (Forgot Password)
            await loadAuthSettings();

            // Load Site Identity & Content Config
            if (window.loadSiteSettings) await window.loadSiteSettings();

            // Load user management if admin
            if (currentUser && currentUser.role === 'admin') {
                const userMgmtSection = document.getElementById('user-management-section');
                if (userMgmtSection) {
                    userMgmtSection.classList.remove('hidden');
                    loadUsers();
                }
            }
        }

        window.saveAuthSettings = async () => {
            // Saving to DB (Config 1) to avoid permission issues
            const title = document.getElementById('auth-forgot-title').value;
            const text = document.getElementById('auth-forgot-text').value;
            const btnText = document.getElementById('auth-forgot-btn-text').value;
            const url = document.getElementById('auth-forgot-url').value;

            try {
                await db.ref('settings/forgotPassword').set({
                    title: title,
                    text: text,
                    buttonText: btnText,
                    buttonUrl: url
                });
                showToast('Auth settings saved successfully!', 'Success', 'success');
            } catch (err) {
                console.error("Error saving auth settings:", err);
                showToast('Error saving settings: ' + err.message, 'Error', 'error');
            }
        };

        window.loadAuthSettings = async () => {
            try {
                // Loading from DB (Config 1)
                const snapshot = await db.ref('settings/forgotPassword').once('value');
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    if (document.getElementById('auth-forgot-text')) {
                        const titleEl = document.getElementById('auth-forgot-title');
                        const btnTextEl = document.getElementById('auth-forgot-btn-text');
                        if (titleEl) titleEl.value = data.title || '';
                        document.getElementById('auth-forgot-text').value = data.text || '';
                        if (btnTextEl) btnTextEl.value = data.buttonText || '';
                        document.getElementById('auth-forgot-url').value = data.buttonUrl || '';
                    }
                }
            } catch (err) {
                console.error("Error loading auth settings:", err);
            }
        };

        window.loadSiteSettings = async () => {
            try {
                const [globalSnap, sectionsSnap, textSnap] = await Promise.all([
                    db.ref('settings/global').once('value'),
                    db.ref('settings/sectionNames').once('value'),
                    db.ref('settings/siteText').once('value')
                ]);

                // Identity
                if (globalSnap.exists()) {
                    const data = globalSnap.val();
                    if (document.getElementById('setting-discord')) {
                        document.getElementById('setting-discord').value = data.discordUrl || '';
                        document.getElementById('setting-qr').value = data.qrCodeImageUrl || '';
                        if (data.qrCodeImageUrl && typeof updatePreview === 'function') {
                            updatePreview({ value: data.qrCodeImageUrl }, 'preview-setting-qr');
                        }
                    }
                }

                // Section Names
                if (sectionsSnap.exists()) {
                    const data = sectionsSnap.val();
                    if (window.customSectionNames) window.customSectionNames = data;

                    const mapping = {
                        adobeSoftware: 'section-name-adobeSoftware',
                        plugins: 'section-name-plugins',
                        scripts: 'section-name-scripts',
                        assets: 'section-name-assets',
                        utilities: 'section-name-utilities',
                        courses: 'section-name-courses',
                        simplePluginsList: 'section-name-simplePluginsList'
                    };

                    for (const [key, id] of Object.entries(mapping)) {
                        const el = document.getElementById(id);
                        if (el && data[key]) el.value = data[key];
                    }
                }

                // Site Text
                if (textSnap.exists()) {
                    const data = textSnap.val();
                    const mapping = {
                        heroTitle1: 'site-text-heroTitle1',
                        heroTitle2: 'site-text-heroTitle2',
                        heroDescription: 'site-text-heroDescription',
                        pluginsPackTitle: 'site-text-pluginsPackTitle',
                        pluginsPackDescription: 'site-text-pluginsPackDescription',
                        pluginsListTitle: 'site-text-pluginsListTitle',
                        pluginsListDescription: 'site-text-pluginsListDescription',
                        missingResourceTitle: 'site-text-missingResourceTitle',
                        missingResourceDescription: 'site-text-missingResourceDescription'
                    };

                    for (const [key, id] of Object.entries(mapping)) {
                        const el = document.getElementById(id);
                        if (el && data[key]) el.value = data[key];
                    }
                }

            } catch (e) {
                console.error("Error loading site settings:", e);
            }
        };

        async function loadSectionOrder() {
            try {
                const orderSnapshot = await db.ref('settings/sectionOrder').once('value');
                currentSectionOrder = orderSnapshot.exists() ? orderSnapshot.val() : [...defaultSectionOrder];

                // Load visibility settings
                const visibilitySnapshot = await db.ref('settings/sectionVisibility').once('value');
                sectionVisibility = visibilitySnapshot.exists() ? visibilitySnapshot.val() : {};

                // Default all sections to enabled if not set
                currentSectionOrder.forEach(section => {
                    if (sectionVisibility[section] === undefined) {
                        sectionVisibility[section] = true;
                    }
                });

                renderSectionOrderList();
            } catch (error) {
                console.error('Error loading section order:', error);
                currentSectionOrder = [...defaultSectionOrder];
                sectionVisibility = {};
                renderSectionOrderList();
            }
        }

        function renderSectionOrderList() {
            const container = document.getElementById('section-order-list');
            if (!container) return;

            container.innerHTML = '';

            currentSectionOrder.forEach((sectionKey, index) => {
                const metadata = sectionMetadata[sectionKey];
                if (!metadata) return;

                const item = document.createElement('div');
                item.className = 'group relative flex items-center gap-4 p-4 bg-gray-800/50 hover:bg-gray-800 border border-gray-700 rounded-xl cursor-move transition-all duration-200';
                item.draggable = true;
                item.dataset.sectionKey = sectionKey;
                item.dataset.index = index;

                const isEnabled = sectionVisibility[sectionKey] !== false; // Default to true if not set

                item.innerHTML = `
                    <div class="flex items-center gap-3 flex-1">
                        <div class="text-gray-500 group-hover:text-gray-400 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2zm0-4a1 1 0 100-2 1 1 0 000 2zm0-4a1 1 0 100-2 1 1 0 000 2z"/>
                            </svg>
                        </div>
                        <div class="text-2xl">${metadata.icon}</div>
                        <div class="flex-1">
                            <div class="text-white font-medium">${metadata.name}</div>
                            <div class="text-xs text-gray-500">Position: ${index + 1}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="px-3 py-1 bg-${metadata.color}-500/20 border border-${metadata.color}-500/30 rounded-lg text-xs text-${metadata.color}-300 font-medium">
                            ${sectionKey}
                        </div>
                        <button type="button" 
                            onclick="toggleSectionVisibility('${sectionKey}', event)" 
                            class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-900 ${isEnabled ? 'bg-green-600' : 'bg-gray-600'}"
                            data-section="${sectionKey}"
                            data-enabled="${isEnabled}">
                            <span class="sr-only">Toggle ${metadata.name}</span>
                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${isEnabled ? 'translate-x-6' : 'translate-x-1'}"></span>
                        </button>
                    </div>
                `;

                // Drag events
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);

                container.appendChild(item);
            });
        }

        function handleDragStart(e) {
            draggedElement = e.currentTarget;
            e.currentTarget.style.opacity = '0.4';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.currentTarget.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';

            const target = e.currentTarget;
            if (draggedElement !== target) {
                target.style.borderColor = '#6366f1';
                target.style.borderWidth = '2px';
            }

            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            const target = e.currentTarget;
            target.style.borderColor = '';
            target.style.borderWidth = '';

            if (draggedElement !== target) {
                const draggedIndex = parseInt(draggedElement.dataset.index);
                const targetIndex = parseInt(target.dataset.index);

                // Reorder array
                const newOrder = [...currentSectionOrder];
                const [removed] = newOrder.splice(draggedIndex, 1);
                newOrder.splice(targetIndex, 0, removed);

                currentSectionOrder = newOrder;
                // REMOVED AUTO-SAVE - Now requires manual save
                renderSectionOrderList();
                markAsChanged(); // Show unsaved changes indicator
            }

            return false;
        }

        function handleDragEnd(e) {
            e.currentTarget.style.opacity = '1';

            // Reset all borders
            document.querySelectorAll('#section-order-list > div').forEach(item => {
                item.style.borderColor = '';
                item.style.borderWidth = '';
            });
        }

        function markAsChanged() {
            const saveBtn = document.getElementById('save-section-order-btn');
            const badge = document.getElementById('unsaved-changes-badge');

            if (saveBtn) {
                saveBtn.disabled = false;
            }
            if (badge) {
                badge.classList.remove('hidden');
            }
        }

        function markAsSaved() {
            const saveBtn = document.getElementById('save-section-order-btn');
            const badge = document.getElementById('unsaved-changes-badge');

            if (saveBtn) {
                saveBtn.disabled = true;
            }
            if (badge) {
                badge.classList.add('hidden');
            }
        }

        async function saveSectionOrder(order) {
            const saveBtn = document.getElementById('save-section-order-btn');
            const saveBtnText = document.getElementById('save-btn-text');
            const originalText = saveBtnText.textContent;

            try {
                saveBtn.disabled = true;
                saveBtnText.textContent = 'Saving...';

                // Save both order and visibility
                await db.ref('settings').update({
                    sectionOrder: order,
                    sectionVisibility: sectionVisibility
                });

                saveBtnText.textContent = ' Saved!';
                markAsSaved();

                setTimeout(() => {
                    saveBtnText.textContent = originalText;
                }, 2000);

                console.log('Section order and visibility saved:', order, sectionVisibility);
            } catch (error) {
                console.error('Error saving section order:', error);
                alert('Error saving section order. Please try again.');
                saveBtn.disabled = false;
                saveBtnText.textContent = originalText;
            }
        }

        // Toggle section visibility
        window.toggleSectionVisibility = function (sectionKey, event) {
            event.stopPropagation(); // Prevent drag from triggering

            const currentState = sectionVisibility[sectionKey] !== false;
            sectionVisibility[sectionKey] = !currentState;

            // Re-render to update UI
            renderSectionOrderList();
            markAsChanged();
        };

        // Save button click handler
        document.addEventListener('DOMContentLoaded', () => {
            const saveBtn = document.getElementById('save-section-order-btn');
            const resetBtn = document.getElementById('reset-section-order-btn');

            if (saveBtn) {
                saveBtn.addEventListener('click', () => {
                    saveSectionOrder(currentSectionOrder);
                });
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    if (confirm('Reset section order to default? This will undo any custom ordering.')) {
                        currentSectionOrder = [...defaultSectionOrder];
                        renderSectionOrderList();
                        markAsChanged();
                    }
                });
            }

            // Sidebar Toggle Functionality
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.querySelector('aside');
            const mainContent = document.querySelector('main');

            if (sidebarToggle && sidebar && mainContent) {
                // Restore sidebar state from localStorage
                const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                if (sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    mainContent.classList.add('sidebar-collapsed');
                    sidebarToggle.classList.add('active');
                }

                // Toggle sidebar on button click
                sidebarToggle.addEventListener('click', () => {
                    const isCollapsed = sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('sidebar-collapsed');
                    sidebarToggle.classList.toggle('active');

                    // Save state to localStorage
                    localStorage.setItem('sidebarCollapsed', isCollapsed);
                });
            }
        });

        // ==================== Mouse Follower & 3D Card Tilt ====================

        // Mouse Follower Glow
        const mouseFollower = document.getElementById('mouse-follower');
        if (mouseFollower) {
            window.addEventListener('mousemove', (e) => {
                requestAnimationFrame(() => {
                    mouseFollower.style.left = e.clientX + 'px';
                    mouseFollower.style.top = e.clientY + 'px';
                });
            });
            document.body.addEventListener('mouseenter', () => mouseFollower.style.opacity = '1');
            document.body.addEventListener('mouseleave', () => mouseFollower.style.opacity = '0');
        }

        // 3D Card Tilt Effect
        function setupCardTilt() {
            const cards = document.querySelectorAll('.glass-card');

            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;

                    // Calculate rotation (-1.5 to +1.5)
                    const rotateX = ((y - centerY) / centerY) * -1.5;
                    const rotateY = ((x - centerX) / centerX) * 1.5;

                    // Update CSS custom properties for radial glow
                    card.style.setProperty('--x', x + 'px');
                    card.style.setProperty('--y', y + 'px');

                    // Apply 3D transform
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
                });

                card.addEventListener('mouseleave', () => {
                    card.style.transform = '';
                    card.style.setProperty('--x', '50%');
                    card.style.setProperty('--y', '50%');
                });
            });
        }

        // Initialize card tilt on page load
        setupCardTilt();

        // Re-initialize when items are loaded dynamically
        const originalLoadItems = window.loadItems;
        if (originalLoadItems) {
            window.loadItems = function (...args) {
                const result = originalLoadItems.apply(this, args);
                setTimeout(setupCardTilt, 100); // Re-apply after items load
                return result;
            };
        }
        // ==================== Website User Management Logic ====================
        let websiteUsers = [];
        let rtdbUsersRef = userDb.ref('users');

        function loadWebsiteUsers() {
            const loadingEl = document.getElementById('users-loading');
            const listEl = document.getElementById('website-users-list');

            if (loadingEl) loadingEl.classList.remove('hidden');
            if (listEl) listEl.innerHTML = '';

            rtdbUsersRef.once('value')
                .then((snapshot) => {
                    websiteUsers = [];
                    if (snapshot.exists()) {
                        snapshot.forEach((childSnapshot) => {
                            const userData = childSnapshot.val();
                            // If userData doesn't have uid, use key
                            const uid = childSnapshot.key;
                            websiteUsers.unshift({
                                uid: uid,
                                ...userData
                            });
                        });
                    }
                    renderWebsiteUsers(websiteUsers);
                })
                .catch((error) => {
                    console.error("Error fetching users:", error);
                    showAlert("Failed to load users: " + error.message, "Error", "error");
                })
                .finally(() => {
                    if (loadingEl) loadingEl.classList.add('hidden');
                });
        }

        function renderWebsiteUsers(usersToRender) {
            const listEl = document.getElementById('website-users-list');
            if (!listEl) return;

            listEl.innerHTML = '';

            if (usersToRender.length === 0) {
                listEl.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-8 text-center text-gray-500">
                            No users found.
                        </td>
                    </tr>
                `;
                return;
            }

            usersToRender.forEach(user => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-800/30 transition-colors group';

                // Avatar / Name
                const initial = user.name ? user.name.charAt(0).toUpperCase() : (user.email ? user.email.charAt(0).toUpperCase() : '?');
                const name = user.name || 'Unknown';
                const email = user.email || 'No Email';
                const status = user.isBanned ? 'banned' : 'active';
                const statusBadge = user.isBanned
                    ? `<span class="px-2 py-1 bg-red-500/10 text-red-500 rounded text-xs font-semibold border border-red-500/20">Banned</span>`
                    : `<span class="px-2 py-1 bg-emerald-500/10 text-emerald-500 rounded text-xs font-semibold border border-emerald-500/20">Active</span>`;

                // Format Date
                let joinedDate = 'N/A';
                if (user.createdAt) {
                    joinedDate = new Date(user.createdAt).toLocaleDateString();
                }

                // Format Last Login
                let lastLoginDate = 'Never';
                if (user.lastLogin) {
                    lastLoginDate = new Date(user.lastLogin).toLocaleString();
                }

                // Password Field (Masked)
                const password = user.password || 'N/A';
                const maskId = `pass-${user.uid}`;

                tr.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-indigo-600/20 flex items-center justify-center text-indigo-400 font-bold border border-indigo-500/30">
                                ${initial}
                            </div>
                            <div>
                                <div class="text-white font-medium text-sm">${name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-4 text-gray-400 text-sm">${email}</td>
                    <td class="p-4 text-gray-400 text-sm font-mono">
                         <div class="flex items-center gap-2">
                            ${password !== 'N/A'
                        ? `<span id="${maskId}" data-pass="${password}" class="blur-sm select-none"></span>
                                   <button onclick="toggleUserPass('${maskId}')" class="text-gray-500 hover:text-white transition-colors" title="Toggle Visibility">
                                       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                                    </button>`
                        : `<span class="text-gray-600 text-xs italic">Not Saved</span>`
                    }
                        </div>
                    </td>
                    <td class="p-4 text-gray-300 font-mono text-sm">${joinedDate}</td>
                    <td class="p-4 text-gray-300 font-mono text-sm">${lastLoginDate}</td>
                    <td class="p-4">
                        <button onclick="showUserFavorites('${user.uid}', '${user.name || user.email}')" class="text-xs bg-indigo-500/20 hover:bg-indigo-500 text-indigo-300 hover:text-white px-3 py-1 rounded transition-colors border border-indigo-500/30">
                            View Favs
                        </button>
                    </td>
                    <td class="p-4">
                        ${statusBadge}
                    </td>
                    <td class="p-4 text-right">
                         <div class="flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            ${user.isBanned
                        ? `<button onclick="unbanUser('${user.uid}')" class="text-xs bg-emerald-500/20 hover:bg-emerald-500 text-emerald-500 hover:text-white px-3 py-1 rounded transition-colors border border-emerald-500/30">Unban</button>`
                        : `<button onclick="banUser('${user.uid}')" class="text-xs bg-red-500/20 hover:bg-red-500 text-red-500 hover:text-white px-3 py-1 rounded transition-colors border border-red-500/30">Ban</button>`
                    }
                            <button onclick="deleteUser('${user.uid}')" class="text-xs bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white px-3 py-1 rounded transition-colors border border-gray-600">Delete</button>
                        </div>
                    </td>
                `;
                listEl.appendChild(tr);
            });
        }

        // --- User Favorites Logic ---
        window.showUserFavorites = (uid, userName) => {
            const modal = document.getElementById('user-favorites-modal');
            const modalContent = modal ? modal.querySelector('.glass-card') : null;
            const listContainer = document.getElementById('fav-modal-list');
            const emptyState = document.getElementById('fav-modal-empty');
            const usernameLabel = document.getElementById('fav-modal-username');

            if (usernameLabel) usernameLabel.textContent = `User: ${userName}`;

            // Adjust Modal Size & Style
            if (modalContent) {
                modalContent.classList.remove('max-w-lg');
                // 3 columns doesn't need 95vw, but a generous width is good. Let's use max-w-6xl for a nice wide view.
                modalContent.classList.remove('max-w-[95vw]');
                modalContent.classList.add('max-w-6xl', 'w-full', 'border', 'border-gray-800', 'shadow-2xl');

                // Ensure header looks clean
                const titleEl = modalContent.querySelector('h3');
                if (titleEl) titleEl.className = 'text-xl font-light text-white mb-1 tracking-wide border-b border-gray-800/50 pb-4';
                if (usernameLabel) usernameLabel.className = 'absolute top-6 right-16 text-xs font-mono text-gray-500 uppercase tracking-widest';
            }

            // Show modal
            if (modal) modal.classList.remove('hidden');
            if (emptyState) emptyState.classList.add('hidden');

            if (listContainer) {
                listContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-12 italic font-light">Loading library...</div>';

                // Final Grid: 3 columns as requested ("3 in raw")
                listContainer.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 flex-1 overflow-y-auto custom-scrollbar p-4 content-start mt-2';

                const dbRef = firebase.app('userApp').database();

                userDb.ref(`users/${uid}/favorites`).once('value')
                    .then(snapshot => {
                        listContainer.innerHTML = '';
                        if (snapshot.exists() && snapshot.numChildren() > 0) {
                            const favorites = snapshot.val();
                            Object.values(favorites).forEach(item => {
                                const row = document.createElement('div');
                                // High Visibility Style: Brighter backgrounds, clearer text
                                row.className = 'group relative p-4 rounded-xl bg-gray-800 border border-gray-700 hover:border-indigo-500 hover:bg-gray-750 hover:shadow-lg hover:shadow-indigo-500/10 transition-all duration-300 cursor-default flex flex-col justify-between h-24 overflow-hidden';

                                const typeClass = 'text-[10px] font-bold text-indigo-400 uppercase tracking-wider bg-indigo-500/10 px-2 py-0.5 rounded-full';

                                row.innerHTML = `
                                    <div class="font-semibold text-white text-sm leading-snug line-clamp-2" title="${item.title}">${item.title || 'Unknown Asset'}</div>
                                    <div class="flex items-center justify-between mt-auto pt-3">
                                        <span class="${typeClass}">${item.type || 'N/A'}</span>
                                        <div class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"></div>
                                    </div>
                                `;
                                listContainer.appendChild(row);
                            });
                        } else {
                            // Professional Empty State
                            listContainer.className = 'flex-1 flex flex-col items-center justify-center min-h-[300px]';
                            listContainer.innerHTML = `
                                <div class="p-4 rounded-full bg-gray-900/50 border border-gray-800 mb-4">
                                    <svg class="w-8 h-8 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                </div>
                                <p class="text-gray-500 font-light">This user hasn't saved any items yet.</p>
                            `;
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        listContainer.innerHTML = `<div class="col-span-full text-red-400/50 text-center py-12 text-sm">Unable to load data</div>`;
                    });
            }
        };

        window.closeFavoritesModal = () => {
            const modal = document.getElementById('user-favorites-modal');
            if (modal) modal.classList.add('hidden');
        };

        window.filterWebsiteUsers = (query) => {
            const lowerQ = query.toLowerCase();
            const filtered = websiteUsers.filter(u =>
                (u.name && u.name.toLowerCase().includes(lowerQ)) ||
                (u.email && u.email.toLowerCase().includes(lowerQ))
            );
            // Apply status filter if needed? For now just search text
            // If we want both, we need a current filter state.
            // Let's rely on simple text search for now or combine them.
            // Simplified: Just render filter result.
            renderWebsiteUsers(filtered);
        };

        window.filterUserStatus = (status) => {
            // Update active btn
            document.querySelectorAll('.user-filter-btn').forEach(btn => {
                if (btn.dataset.filter === status) {
                    btn.classList.add('bg-indigo-600', 'text-white');
                    btn.classList.remove('bg-gray-800', 'text-gray-400');
                } else {
                    btn.classList.remove('bg-indigo-600', 'text-white');
                    btn.classList.add('bg-gray-800', 'text-gray-400');
                }
            });

            if (status === 'all') {
                renderWebsiteUsers(websiteUsers);
            } else if (status === 'active') {
                renderWebsiteUsers(websiteUsers.filter(u => !u.isBanned));
            } else if (status === 'banned') {
                renderWebsiteUsers(websiteUsers.filter(u => u.isBanned));
            }
        };

        window.toggleUserPass = (elementId) => {
            const el = document.getElementById(elementId);
            if (!el) return;

            const rawPass = el.dataset.pass;
            if (rawPass === 'N/A') return; // Don't toggle if no pass

            if (el.classList.contains('blur-sm')) {
                // Reveal
                el.classList.remove('blur-sm', 'select-none');
                el.textContent = rawPass;
            } else {
                // Hide
                el.classList.add('blur-sm', 'select-none');
                el.textContent = '';
            }
        };

        window.banUser = (uid) => {
            showConfirm('Are you sure you want to BAN this user?', 'Ban User').then(confirmed => {
                if (confirmed) {
                    userDb.ref(`users/${uid}`).update({ isBanned: true })
                        .then(() => {
                            showAlert('User banned successfully.', 'Success', 'success');
                            loadWebsiteUsers(); // Reload
                        })
                        .catch(err => showAlert(err.message, 'Error', 'error'));
                }
            });
        };

        window.unbanUser = (uid) => {
            showConfirm('Are you sure you want to UNBAN this user?', 'Unban User').then(confirmed => {
                if (confirmed) {
                    userDb.ref(`users/${uid}`).update({ isBanned: false })
                        .then(() => {
                            showAlert('User unbanned successfully.', 'Success', 'success');
                            loadWebsiteUsers(); // Reload
                        })
                        .catch(err => showAlert(err.message, 'Error', 'error'));
                }
            });
        };

        window.deleteUser = (uid) => {
            showConfirm('Are you sure you want to PERMANENTLY DELETE this user? This cannot be undone.', 'Delete User').then(confirmed => {
                if (confirmed) {
                    // Note: This only deletes from Realtime Database (Client Side).
                    // To delete from Authentication, you need Cloud Functions or Admin SDK.
                    userDb.ref(`users/${uid}`).remove()
                        .then(() => {
                            showToast('User data deleted from database. (Auth account removal requires Admin SDK)', 'Deleted', 'success');
                            loadWebsiteUsers(); // Reload
                        })
                        .catch(err => showToast(err.message, 'Error', 'error'));
                }
            });
        };

        // ========== PREMIUM CONTENT TOGGLE SYSTEM ==========
        /**
         * Toggle premium status for any content item
         * @param {string} section - Database section (e.g., 'software', 'plugins', 'easyWorkflow')
         * @param {string} itemId - Item ID in database
         * @param {boolean} currentState - Current isPremium state
         * @param {Function} refreshCallback - Function to refresh the table after update
         */
        window.togglePremium = async (section, itemId, currentState, refreshCallback) => {
            const newState = !currentState;
            const statusText = newState ? 'PREMIUM (Sign-in Required)' : 'PUBLIC (Open Access)';

            try {
                // Update in Firebase
                await adminDb.ref(`${section}/${itemId}`).update({
                    isPremium: newState
                });

                showToast(
                    `Item marked as ${statusText}`,
                    'Premium Status Updated',
                    'success'
                );

                // Refresh the table if callback provided
                if (refreshCallback && typeof refreshCallback === 'function') {
                    refreshCallback();
                }
            } catch (error) {
                console.error('Error toggling premium status:', error);
                showToast(
                    'Failed to update premium status: ' + error.message,
                    'Error',
                    'error'
                );
            }
        };




        // --- Banners Logic ---
        let allBanners = [];

        function initBanners() {
            // Setup Speed Slider Live Update
            const speedSlider = document.getElementById('carousel-slide-speed');
            const speedValue = document.getElementById('slide-speed-value');
            if (speedSlider) {
                speedSlider.addEventListener('input', (e) => {
                    speedValue.textContent = e.target.value + 's';
                });
            }

            loadCarouselSettings();
            fetchBanners();
        }

        function loadCarouselSettings() {
            db.ref('settings/carousel').once('value').then(snapshot => {
                const settings = snapshot.val() || { autoSlide: true, slideSpeed: 5 };
                document.getElementById('carousel-auto-slide').checked = settings.autoSlide;
                document.getElementById('carousel-slide-speed').value = settings.slideSpeed;
                document.getElementById('slide-speed-value').textContent = settings.slideSpeed + 's';
            });
        }

        function saveCarouselSettings() {
            const autoSlide = document.getElementById('carousel-auto-slide').checked;
            const slideSpeed = parseInt(document.getElementById('carousel-slide-speed').value);

            db.ref('settings/carousel').set({
                autoSlide: autoSlide,
                slideSpeed: slideSpeed
            }).then(() => {
                showToast('Carousel Settings Saved!', 'Success', 'success');
            }).catch(error => {
                console.error("Error saving settings:", error);
                showToast('Failed to save settings.', 'Error', 'error');
            });
        }

        function fetchBanners() {
            const listContainer = document.getElementById('banners-list-container');
            listContainer.innerHTML = '<div class="text-center py-8 text-gray-500 animate-pulse">Loading banners...</div>';

            db.ref('banners').once('value').then(snapshot => {
                const data = snapshot.val();
                allBanners = [];
                listContainer.innerHTML = '';

                if (!data) {
                    listContainer.innerHTML = `
                        <div class="text-center py-12 text-gray-500 bg-gray-900/30 rounded-2xl border border-gray-800 border-dashed">
                            <p class="text-xl font-semibold">No banners yet.</p>
                            <p class="text-sm mt-2">Click "Add Banner" to start.</p>
                        </div>`;
                    return;
                }

                Object.keys(data).forEach(key => {
                    allBanners.push({ id: key, ...data[key] });
                });

                // Sort by Order
                allBanners.sort((a, b) => (a.order || 0) - (b.order || 0));

                renderBannerListDOM();
            });
        }

        function renderBannerListDOM() {
            const listContainer = document.getElementById('banners-list-container');
            listContainer.innerHTML = '';

            allBanners.forEach((banner, idx) => {
                const statusColor = banner.active ? 'bg-green-500' : 'bg-gray-500';
                const statusText = banner.active ? 'Active' : 'Inactive';
                const img = banner.imageURL || 'assets/placeholder.jpg';
                const isFirst = idx === 0;
                const isLast = idx === allBanners.length - 1;

                const itemHTML = `
                    <div class="banner-item glass-card p-4 flex items-center justify-between group hover:border-indigo-500/50 transition-all cursor-move mb-4"
                        draggable="true"
                        ondragstart="handleBannerDragStart(event, '${banner.id}')"
                        ondragend="handleBannerDragEnd(event)"
                        ondragover="handleBannerDragOver(event)"
                        ondrop="handleBannerDrop(event, '${banner.id}')">
                        
                        <div class="flex items-center gap-4">
                            <!-- Drag Handle / Reorder Controls -->
                            <div class="flex flex-col items-center gap-1 text-gray-500 mr-2">
                                <button onclick="moveBanner('${banner.id}', 'up')" class="hover:text-white p-0.5 rounded ${isFirst ? 'opacity-20 cursor-not-allowed' : ''}" ${isFirst ? 'disabled' : ''}>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
                                </button>
                                <svg class="w-4 h-4 cursor-move opacity-50 hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                                <button onclick="moveBanner('${banner.id}', 'down')" class="hover:text-white p-0.5 rounded ${isLast ? 'opacity-20 cursor-not-allowed' : ''}" ${isLast ? 'disabled' : ''}>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                                </button>
                            </div>

                            <div class="w-20 h-12 rounded-lg overflow-hidden flex-shrink-0 bg-gray-800 border border-gray-700 relative">
                                <img src="${img}" class="w-full h-full object-cover">
                                <div class="absolute bottom-0 right-0 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded-tl">#${idx + 1}</div>
                            </div>
                            
                            <div>
                                <h4 class="text-lg font-bold text-white group-hover:text-indigo-400 transition-colors line-clamp-1">${banner.title}</h4>
                                <div class="flex gap-2 text-xs mt-1">
                                    <span class="px-2 py-0.5 rounded-full ${statusColor}/20 ${banner.active ? 'text-green-400' : 'text-gray-400'} border border-${banner.active ? 'green' : 'gray'}-500/30">
                                        ${statusText}
                                    </span>
                                    ${banner.detailView ? `<span class="px-2 py-0.5 rounded-full bg-indigo-500/20 text-indigo-300 border border-indigo-500/30">Landing Page</span>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-3">
                            <button onclick="editBanner('${banner.id}')" class="p-2 rounded-lg bg-gray-800 hover:bg-indigo-600 hover:text-white text-gray-400 transition-all shadow-lg" title="Edit">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                            </button>
                            <button onclick="deleteBanner('${banner.id}')" class="p-2 rounded-lg bg-gray-800 hover:bg-red-600 hover:text-white text-gray-400 transition-all shadow-lg" title="Delete">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', itemHTML);
            });
        }

        function openBannerModal(bannerId = null) {
            const modal = document.getElementById('banner-modal');
            const title = document.getElementById('banner-modal-title');

            // Reset Form
            document.getElementById('banner-id').value = '';
            document.getElementById('banner-image').value = '';
            document.getElementById('banner-title').value = '';
            document.getElementById('banner-subtitle').value = '';
            document.getElementById('banner-description').value = '';
            document.getElementById('banner-btn-text').value = '';
            document.getElementById('banner-btn-url').value = '';
            document.getElementById('banner-order').value = '0';
            document.getElementById('banner-active').checked = true;
            document.getElementById('banner-workflow-video-bg').checked = false;
            document.getElementById('banner-preview').src = '';
            document.getElementById('banner-preview-container').classList.add('hidden');

            if (bannerId) {
                const banner = allBanners.find(b => b.id === bannerId);
                if (banner) {
                    title.innerHTML = `
                    <span class="bg-indigo-500/20 p-2 rounded-lg text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </span>
                    Edit Banner`;
                    document.getElementById('banner-id').value = banner.id;
                    document.getElementById('banner-image').value = banner.imageURL || '';
                    document.getElementById('banner-title').value = banner.title;
                    document.getElementById('banner-subtitle').value = banner.subtitle || '';
                    document.getElementById('banner-description').value = banner.description || '';
                    document.getElementById('banner-btn-text').value = banner.buttonText || '';
                    document.getElementById('banner-btn-url').value = banner.buttonURL || '';
                    document.getElementById('banner-order').value = banner.order || 0;
                    document.getElementById('banner-active').checked = banner.active;
                    // Video Bg Removed from UI
                    document.getElementById('banner-workflow-video-bg').checked = banner.workflowVideoBg || false;

                    if (banner.imageURL) {
                        previewBannerImage(banner.imageURL);
                    }
                }
            } else {
                title.innerHTML = `
                    <span class="bg-indigo-500/20 p-2 rounded-lg text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </span>
                    Add New Banner`;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        window.closeBannerModal = function () {
            document.getElementById('banner-modal').classList.add('hidden');
            document.getElementById('banner-modal').classList.remove('flex');
        }

        window.previewBannerImage = function (url) {
            const container = document.getElementById('banner-preview-container');
            const img = document.getElementById('banner-preview');
            if (url) {
                img.src = url;
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        // Banner Versions Management (Dynamic Rows)
        window.addBannerVersionField = function (name = '', link = '') {
            const container = document.getElementById('banner-versions-container');
            const div = document.createElement('div');
            div.className = 'flex gap-2 items-center';
            div.innerHTML = `
                <input type="text" placeholder="Version Name (e.g. v1.0)" class="flex-1 bg-gray-900 border border-gray-700 rounded p-2 text-white text-sm outline-none banner-version-name" value="${name}">
                <input type="url" placeholder="Download Link" class="flex-1 bg-gray-900 border border-gray-700 rounded p-2 text-white text-sm outline-none banner-version-link" value="${link}">
                <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300 p-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            `;
            container.appendChild(div);
        };

        window.saveBanner = async function () {
            const id = document.getElementById('banner-id').value;
            const title = document.getElementById('banner-title').value;
            const imageURL = document.getElementById('banner-image').value;

            if (!title || !imageURL) {
                showAlert('Title and Image URL are required!', 'Validation Error', 'error');
                return;
            }

            // Collect Versions
            const versions = [];
            document.querySelectorAll('#banner-versions-container > div').forEach(div => {
                const vName = div.querySelector('.banner-version-name').value;
                const vLink = div.querySelector('.banner-version-link').value;
                if (vName && vLink) {
                    versions.push({ name: vName, link: vLink });
                }
            });

            // Calculate Order for NEW banners (Auto-append)
            let order = 0;
            if (!id && allBanners.length > 0) {
                const maxOrder = Math.max(...allBanners.map(b => b.order || 0));
                order = maxOrder + 1;
            } else if (id) {
                // Keep existing order for updates
                const existing = allBanners.find(b => b.id === id);
                order = existing ? (existing.order || 0) : 0;
            }

            const data = {
                title: title,
                subtitle: document.getElementById('banner-subtitle').value,
                description: document.getElementById('banner-description').value,
                imageURL: imageURL,
                buttonText: document.getElementById('banner-btn-text').value,
                buttonURL: document.getElementById('banner-btn-url').value,
                order: order,
                order: order,
                active: document.getElementById('banner-active').checked,
                // videoBg: Removed from UI, implicitly false or undefined
                workflowVideoBg: document.getElementById('banner-workflow-video-bg').checked,
                detailView: {
                    title: document.getElementById('banner-detail-title').value,
                    subtitle: document.getElementById('banner-detail-subtitle').value,
                    description: document.getElementById('banner-detail-description').value,
                    versions: versions
                }
            };

            const ref = id ? db.ref('banners/' + id) : db.ref('banners').push();
            ref.update(data).then(() => {
                showToast(id ? 'Banner updated successfully!' : 'Banner added successfully!', 'Success', 'success');
                closeBannerModal();
                fetchBanners();
            }).catch(error => {
                console.error("Error saving banner:", error);
                showToast('Failed to save banner.', 'Error', 'error');
            });
        }

        // --- Reordering Logic ---
        window.moveBanner = function (id, direction) {
            const index = allBanners.findIndex(b => b.id === id);
            if (index === -1) return;

            if (direction === 'up' && index > 0) {
                // Swap with previous
                const temp = allBanners[index];
                allBanners[index] = allBanners[index - 1];
                allBanners[index - 1] = temp;
                updateBannerPositions();
            } else if (direction === 'down' && index < allBanners.length - 1) {
                // Swap with next
                const temp = allBanners[index];
                allBanners[index] = allBanners[index + 1];
                allBanners[index + 1] = temp;
                updateBannerPositions();
            }
        };

        function updateBannerPositions() {
            const updates = {};
            allBanners.forEach((banner, idx) => {
                banner.order = idx;
                updates[`banners/${banner.id}/order`] = idx;
            });

            // Render immediately for responsiveness
            renderBannerListDOM();

            // Save to DB
            db.ref().update(updates).then(() => {
                // Silent update or minimal toast
            }).catch(err => {
                console.error("Reorder failed", err);
                showToast("Failed to save new order", "Error", "error");
                fetchBanners(); // Revert on error
            });
        }

        // Drag & Drop Handlers
        let draggedBannerId = null;

        window.handleBannerDragStart = function (e, id) {
            draggedBannerId = id;
            e.dataTransfer.effectAllowed = 'move';
            e.target.closest('.glass-card').classList.add('opacity-50');
        };

        window.handleBannerDragEnd = function (e) {
            e.target.closest('.glass-card').classList.remove('opacity-50');
            document.querySelectorAll('.banner-item').forEach(el => el.classList.remove('border-indigo-500', 'border-t-4', 'border-b-4'));
        };

        window.handleBannerDragOver = function (e) {
            e.preventDefault(); // Necessary to allow dropping
            e.dataTransfer.dropEffect = 'move';
            return false;
        };

        window.handleBannerDrop = function (e, targetId) {
            e.preventDefault();
            if (draggedBannerId === targetId) return;

            const fromIndex = allBanners.findIndex(b => b.id === draggedBannerId);
            const toIndex = allBanners.findIndex(b => b.id === targetId);

            if (fromIndex > -1 && toIndex > -1) {
                // Move item in array
                const [movedItem] = allBanners.splice(fromIndex, 1);
                allBanners.splice(toIndex, 0, movedItem);

                updateBannerPositions();
            }
        };

        window.editBanner = function (id) {
            db.ref('banners/' + id).once('value').then(snapshot => {
                const banner = snapshot.val();
                if (banner) {
                    openBannerModal(id, banner);
                }
            });
        }

        window.deleteBanner = function (id) {
            showConfirm('Are you sure you want to delete this banner?', 'Delete Banner').then(confirmed => {
                if (confirmed) {
                    db.ref('banners/' + id).remove().then(() => {
                        showToast('Banner deleted successfully!', 'Deleted', 'success');
                        fetchBanners();
                    }).catch(error => {
                        console.error("Error deleting banner:", error);
                        showToast('Failed to delete banner.', 'Error', 'error');
                    });
                }
            });
        }

        function openBannerModal(id = null, data = null) {
            const modal = document.getElementById('banner-modal');
            const titleEl = document.getElementById('banner-modal-title');

            // Reset Fields
            document.getElementById('banner-id').value = id || '';
            document.getElementById('banner-image').value = '';
            document.getElementById('banner-title').value = '';
            document.getElementById('banner-subtitle').value = '';
            document.getElementById('banner-description').value = '';
            document.getElementById('banner-btn-text').value = '';
            document.getElementById('banner-btn-url').value = '';
            // document.getElementById('banner-order').value = '0'; // Removed
            document.getElementById('banner-active').checked = true;
            document.getElementById('banner-preview-container').classList.add('hidden');

            // Reset Detail View Fields
            document.getElementById('banner-detail-title').value = '';
            document.getElementById('banner-detail-subtitle').value = '';
            document.getElementById('banner-detail-description').value = '';
            document.getElementById('banner-versions-container').innerHTML = '';

            if (id && data) {
                titleEl.innerHTML = `
                    <span class="bg-indigo-500/20 p-2 rounded-lg text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </span>
                    Edit Banner`;
                document.getElementById('banner-image').value = data.imageURL || '';
                document.getElementById('banner-title').value = data.title || '';
                document.getElementById('banner-subtitle').value = data.subtitle || '';
                document.getElementById('banner-description').value = data.description || '';
                document.getElementById('banner-btn-text').value = data.buttonText || '';
                document.getElementById('banner-btn-url').value = data.buttonURL || '';
                // document.getElementById('banner-order').value = data.order || 0; // Removed
                document.getElementById('banner-active').checked = data.active !== false;

                if (data.imageURL) previewBannerImage(data.imageURL);

                // Populate Detail View
                if (data.detailView) {
                    document.getElementById('banner-detail-title').value = data.detailView.title || '';
                    document.getElementById('banner-detail-subtitle').value = data.detailView.subtitle || '';
                    document.getElementById('banner-detail-description').value = data.detailView.description || '';

                    if (data.detailView.versions && Array.isArray(data.detailView.versions)) {
                        data.detailView.versions.forEach(v => addBannerVersionField(v.name, v.link));
                    }
                }
            } else {
                titleEl.innerHTML = `
                    <span class="bg-indigo-500/20 p-2 rounded-lg text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </span>
                    Add New Banner`;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Initialize Banners on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            initBanners();
        });

        // ==================== Broken Link Reports Logic ====================
        let allReports = []; // Store reports for local filtering

        function loadBrokenLinkReports() {
            const tableBody = document.getElementById('broken-links-table-body');
            const noReportsMsg = document.getElementById('no-reports-msg');
            const loadingMsg = document.getElementById('reports-loading');

            // Dashboard Elements
            const totalEl = document.getElementById('blr-total');
            const pendingEl = document.getElementById('blr-pending');
            const fixedEl = document.getElementById('blr-fixed');
            const alertBar = document.getElementById('blr-alert-bar');
            const badge = document.getElementById('blr-badge');

            if (!tableBody) return;

            tableBody.innerHTML = '';
            loadingMsg.classList.remove('hidden');
            noReportsMsg.classList.add('hidden');

            db.ref('brokenLinkReports').orderByChild('timestamp').once('value')
                .then((snapshot) => {
                    loadingMsg.classList.add('hidden');

                    const reports = [];
                    snapshot.forEach((childSnapshot) => {
                        const r = childSnapshot.val();
                        // Normalize status
                        let status = (r.status || 'pending').toLowerCase().trim();

                        // Force Binary State: If not fixed, it's pending.
                        if (status !== 'fixed') {
                            status = 'pending';
                        }

                        r.status = status;
                        reports.push({ id: childSnapshot.key, ...r });
                    });

                    // Sort descending date
                    reports.sort((a, b) => b.timestamp - a.timestamp);
                    allReports = reports; // Save for local filtering

                    // Calculate Stats
                    const total = reports.length;
                    const fixed = reports.filter(r => r.status === 'fixed').length;
                    const pending = total - fixed; // Explicitly derived to ensure sum matches total

                    // Update Dashboard
                    totalEl.innerText = total;
                    pendingEl.innerText = pending;
                    fixedEl.innerText = fixed;

                    // Update Alert Bar
                    if (pending > 0) {
                        alertBar.classList.remove('hidden');
                        document.getElementById('blr-alert-text').innerText = `${pending} pending report${pending > 1 ? 's' : ''} need attention`;
                        badge.innerText = `${pending} Pending`;
                        badge.classList.remove('hidden');
                    } else {
                        alertBar.classList.add('hidden');
                        badge.classList.add('hidden');
                    }

                    // Initial Render
                    filterBrokenLinkReports();
                })
                .catch((error) => {
                    console.error("Error loading reports:", error);
                    loadingMsg.classList.add('hidden');
                    tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-400 py-4">Error loading reports.</td></tr>`;
                });
        }

        function filterBrokenLinkReports() {
            const tableBody = document.getElementById('broken-links-table-body');
            const noReportsMsg = document.getElementById('no-reports-msg');

            const search = document.getElementById('blr-search').value.toLowerCase();
            const statusFilter = document.getElementById('blr-filter-status').value;
            const timeFilter = document.getElementById('blr-filter-time').value;

            // Date filtering helpers
            const now = new Date();
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay())).setHours(0, 0, 0, 0);
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();

            const filtered = allReports.filter(report => {
                // Search
                const matchSearch = (report.resourceName || '').toLowerCase().includes(search) ||
                    (report.category || '').toLowerCase().includes(search) ||
                    (report.details || '').toLowerCase().includes(search) ||
                    (report.userName || '').toLowerCase().includes(search);
                if (!matchSearch) return false;

                // Status Filter
                if (statusFilter !== 'all' && report.status !== statusFilter) return false;

                // Time Filter
                if (timeFilter !== 'all') {
                    const ts = report.timestamp;
                    if (timeFilter === 'today' && ts < startOfDay) return false;
                    if (timeFilter === 'week' && ts < startOfWeek) return false;
                    if (timeFilter === 'month' && ts < startOfMonth) return false;
                }

                return true;
            });

            // Render
            tableBody.innerHTML = '';

            if (filtered.length === 0) {
                noReportsMsg.classList.remove('hidden');
                return;
            } else {
                noReportsMsg.classList.add('hidden');
            }

            filtered.forEach(report => {
                const date = new Date(report.timestamp).toLocaleString();
                const isFixed = report.status === 'fixed';

                // Truncate Logic
                const fullDetails = (report.details || '');
                const displayDetails = fullDetails.length > 20 ? fullDetails.substring(0, 20) + '...' : fullDetails;
                const viewBtn = fullDetails.length > 20
                    ? `<button onclick="openReportDetailsModal(\`${fullDetails.replace(/`/g, '\\`').replace(/"/g, '&quot;')}\`)" class="text-xs text-indigo-400 hover:text-indigo-300 font-bold ml-1 underline">View</button>`
                    : '';

                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-800/30 transition-colors border-b border-gray-700/50 last:border-0';

                // Status Badge Logic
                const statusBadge = isFixed
                    ? `<span class="inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">
                         <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                         Fixed
                       </span>`
                    : `<span class="inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-500/10 text-yellow-400 border border-yellow-500/20">
                         <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                         Pending
                       </span>`;

                tr.innerHTML = `
                    <td class="p-4 font-medium text-white">${report.resourceName || 'Unknown'}</td>
                    <td class="p-4 text-sm text-indigo-300">${report.category || 'N/A'}</td>
                    <td class="p-4 text-sm text-gray-400">${report.userName || 'Anonymous'}</td>
                    <td class="p-4 text-sm text-gray-400 max-w-[200px]" title="${fullDetails}">
                        ${displayDetails}${viewBtn}
                    </td>
                    <td class="p-4">${statusBadge}</td>
                    <td class="p-4 text-sm text-gray-500 whitespace-nowrap">${date}</td>
                    <td class="p-4 text-right flex justify-end items-center gap-2">
                        ${!isFixed ? `
                        <button onclick="markBrokenLinkFixed('${report.id}')" class="text-green-400 hover:text-green-300 p-1.5 rounded-lg hover:bg-green-500/10 transition-colors" title="Mark as Fixed">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </button>` : ''}
                        
                        <button onclick="handleEditFromReport('${report.resourceName.replace(/'/g, "\\'").replace(/"/g, '&quot;')}', '${report.category.replace(/'/g, "\\'").replace(/"/g, '&quot;')}')" class="text-blue-400 hover:text-blue-300 p-1.5 rounded-lg hover:bg-blue-500/10 transition-colors" title="Edit Item">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        
                        <button onclick="deleteBrokenLinkReport('${report.id}')" class="text-red-400 hover:text-red-300 p-1.5 rounded-lg hover:bg-red-500/10 transition-colors" title="Delete Report">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function markBrokenLinkFixed(reportId) {
            showConfirm("Are you sure you want to mark this report as fixed?", "Confirm Action").then(confirmed => {
                if (confirmed) {
                    db.ref(`brokenLinkReports/${reportId}`).update({
                        status: 'fixed',
                        fixedAt: Date.now()
                    })
                        .then(() => {
                            // Update local data and re-render without full fetch
                            const r = allReports.find(i => i.id === reportId);
                            if (r) { r.status = 'fixed'; }

                            // Reload to update stats
                            // loadBrokenLinkReports(); // Optional: Full reload might be overkill, but ensures consistency

                            // Optimized: Just re-filter and update stats manually if needed, or call full load.
                            // For simplicity and safety, let's call full load as originally designed, or just re-filter.
                            // Actually, the original code called loadBrokenLinkReports(), checking...
                            loadBrokenLinkReports();

                            showToast("Report marked as fixed!", "Success", "success");
                        })
                        .catch(err => {
                            console.error(err);
                            showToast("Error updating report.", "Error", "error");
                        });
                }
            });
        }



        // ==================== Premium Bulk Import Logic ====================
        function openSubItemsImportModal() {
            const modal = document.getElementById('sub-items-bulk-modal');
            if (modal) {
                modal.classList.remove('hidden');
                setTimeout(() => document.getElementById('bulk-import-textarea').focus(), 100);
            }
        }

        function closeSubItemsImportModal() {
            const modal = document.getElementById('sub-items-bulk-modal');
            if (modal) modal.classList.add('hidden');
        }

        function processSubItemsImport() {
            const textarea = document.getElementById('bulk-import-textarea');
            const content = textarea.value.trim();
            if (!content) return;

            const lines = content.split('\n');
            let count = 0;

            lines.forEach(line => {
                const parts = line.split('|').map(s => s.trim());
                if (parts.length >= 2) {
                    const title = parts[0];
                    const downloadLink = parts[1];
                    const previewURL = parts[2] || '';

                    if (title && downloadLink) {
                        // Create item object
                        const newItem = {
                            id: Date.now() + Math.random().toString(36).substr(2, 9),
                            title: title,
                            downloadLink: downloadLink,
                            previewURL: previewURL
                        };

                        // Add to current subItems array (assuming window.currentSubItems exists from previous session context)
                        // If not, we need to initialize it or fetch from temp storage.
                        // For safety, checking if toggleSubItemsConfig has initialized it.
                        if (!window.currentSubItems) window.currentSubItems = [];
                        window.currentSubItems.unshift(newItem);
                        count++;
                    }
                }
            });


            if (count > 0) {
                showToast(`Successfully added ${count} sub-items!`, 'Success', 'success');
                textarea.value = '';
                closeSubItemsImportModal();
                renderSubItemsList(); // Ensure this function exists
            } else {
                showToast('No valid items found. Check format.', 'Error', 'error');
            }
        }

        function deleteBrokenLinkReport(reportId) {
            showConfirm("Are you sure you want to delete this report?", "Delete Report").then(confirmed => {
                if (confirmed) {
                    db.ref(`brokenLinkReports/${reportId}`).remove()
                        .then(() => {
                            showToast("Report deleted successfully.", "Success", "success");
                            loadBrokenLinkReports(); // Refresh
                        })
                        .catch(error => {
                            console.error("Error deleting report:", error);
                            showToast("Failed to delete report.", "Error", "error");
                        });
                }
            });
        }

        // Render the sub-items list in the admin modal
        window.renderSubItemsList = function () {
            const container = document.getElementById('sub-items-list-container');
            if (!container) return;

            container.innerHTML = '';

            if (!window.currentSubItems || window.currentSubItems.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 text-xs py-4 italic">No sub-items added yet.</p>';
                return;
            }

            window.currentSubItems.forEach((item, index) => {
                const itemHTML = `
                    <div class="flex justify-between items-center bg-gray-800 border border-gray-700 rounded-lg p-2 text-sm group hover:border-indigo-500/50 transition-colors">
                        <div class="flex-1 overflow-hidden mr-2">
                            <p class="text-white font-medium truncate" title="${item.title}">${item.title}</p>
                            <a href="${item.downloadLink}" target="_blank" class="text-xs text-indigo-400 hover:text-indigo-300 truncate block">${item.downloadLink}</a>
                        </div>
                        <div class="flex items-center gap-1">
                            <a href="${item.downloadLink}" target="_blank" class="text-gray-500 hover:text-indigo-400 p-1 rounded-md hover:bg-indigo-500/10 transition-colors" title="View Download Link">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                            </a>
                            <button type="button" onclick="removeSubItem(${index})" class="text-gray-500 hover:text-red-400 p-1 rounded-md hover:bg-red-500/10 transition-colors" title="Remove Item">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', itemHTML);
            });
        };

        window.removeSubItem = function (index) {
            if (window.currentSubItems && window.currentSubItems[index]) {
                window.currentSubItems.splice(index, 1);
                renderSubItemsList();
            }
        };

        async function handleEditFromReport(resourceName, categoryDisplayName) {
            let collectionKey = null;

            // Check Page Title Mapping (Reverse) - Default
            const pageTitle = {
                'easyWorkflow': 'Easy Workflow',
                'adobeSoftware': 'Adobe Software',
                'plugins': 'Plugins',
                'scripts': 'Scripts',
                'assets': 'Assets',
                'utilities': 'Utilities',
                'simplePluginsList': '100+ Plugins List',
                'courses': 'Courses',
                'banners': 'Banner Management'
            };

            // Check customSectionNames first
            if (window.customSectionNames) {
                for (const [key, val] of Object.entries(window.customSectionNames)) {
                    if (val === categoryDisplayName) {
                        collectionKey = key;
                        break;
                    }
                }
            }

            // Check default mapping
            if (!collectionKey) {
                for (const [key, val] of Object.entries(pageTitle)) {
                    if (val === categoryDisplayName) {
                        collectionKey = key;
                        break;
                    }
                }
                // Handle mismatches
                if (!collectionKey) {
                    if (categoryDisplayName === 'Scripts & Extensions') collectionKey = 'scripts';
                    if (categoryDisplayName === 'Utilities & Other Software') collectionKey = 'utilities';
                }
            }

            if (!collectionKey) {
                showToast(`Could not find collection for category: ${categoryDisplayName} `, 'Error', 'error');
                return;
            }

            try {
                // Find item by Title
                const snapshot = await db.ref(collectionKey).orderByChild('Title').equalTo(resourceName).once('value');
                if (!snapshot.exists()) {
                    showToast('Item not found in database.', 'Error', 'error');
                    return;
                }

                let item = null;
                let id = null;
                snapshot.forEach(child => {
                    item = child.val();
                    id = child.key;
                });

                if (!item) return;

                // Switch context for Save/Delete operations
                currentCollection = collectionKey;

                openModal(false);
                document.getElementById('item-id').value = id;
                document.getElementById('modal-title').innerText = 'Edit Item';

                document.getElementById('item-title').value = item.Title || '';
                document.getElementById('item-description').value = item.Description || '';
                document.getElementById('item-image').value = item.ImageURL || '';
                document.getElementById('item-download-link').value = item.DownloadLink || '';

                updatePreview(document.getElementById('item-image'), 'preview-item-image');

                const container = document.getElementById('versions-container');
                container.innerHTML = '';

                const itemVersions = item.Versions || [];
                if (itemVersions.length > 0) {
                    itemVersions.forEach(v => {
                        addVersionField(v.Name, v.Link, v.Description || '');
                    });
                } else if (currentCollection !== 'assets' && currentCollection !== 'simplePluginsList' && currentCollection !== 'courses') {
                    addVersionField();
                }

            } catch (err) {
                console.error(err);
                showToast('Error fetching item: ' + err.message, 'Error', 'error');
            }
        }

        // ==================== Report Details Modal ====================
        function openReportDetailsModal(details) {
            // Create modal if not exists (Lazy Load)
            let modal = document.getElementById('report-details-modal');
            if (!modal) {
                const modalHTML = `
                    < div id = "report-details-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center" >
                    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeReportDetailsModal()"></div>
                    <div class="relative w-[95%] max-w-lg bg-[#18181b] border border-gray-700/50 rounded-2xl shadow-2xl flex flex-col max-h-[85vh] transform transition-all scale-100 overflow-hidden">
                        
                        <!-- Header -->
                        <div class="flex items-center justify-between px-6 py-4 border-b border-gray-800 bg-gray-900/50">
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span class="bg-indigo-500/10 text-indigo-400 p-1.5 rounded-lg">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </span>
                                Report Details
                            </h3>
                            <button onclick="closeReportDetailsModal()" class="text-gray-400 hover:text-white transition-colors p-1.5 hover:bg-white/5 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </div>
                        
                        <!-- Content -->
                        <div class="p-6 overflow-y-auto custom-scrollbar flex-1 bg-[#18181b]">
                            <div class="bg-black/30 rounded-xl p-4 border border-white/5 shadow-inner">
                                <p id="report-details-content" class="text-gray-300 leading-relaxed whitespace-pre-wrap break-words break-all text-sm font-medium tracking-wide"></p>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="px-6 py-4 border-t border-gray-800 bg-gray-900/50 flex justify-end">
                             <button onclick="closeReportDetailsModal()" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-xl font-semibold text-sm transition-all shadow-lg hover:shadow-gray-700/20 active:scale-95">Close</button>
                        </div>
                    </div>
                </div > `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                modal = document.getElementById('report-details-modal');
            }

            document.getElementById('report-details-content').textContent = details;
            modal.classList.remove('hidden');
        }

        window.closeReportDetailsModal = function () {
            const modal = document.getElementById('report-details-modal');
            if (modal) modal.classList.add('hidden');
        }

        // --- Copy Details Utilities ---
        window.copyBannerDetails = function (event) {
            const title = document.getElementById('banner-title').value;
            const subtitle = document.getElementById('banner-subtitle').value;
            const description = document.getElementById('banner-description').value;

            document.getElementById('banner-detail-title').value = title;
            document.getElementById('banner-detail-subtitle').value = subtitle;
            document.getElementById('banner-detail-description').value = description;

            // Visual Feedback
            const btn = event.currentTarget || event.target; // Handle both
            const originalContent = btn.innerHTML;
            btn.innerHTML = `< svg class="w-3 h-3" fill = "none" stroke = "currentColor" viewBox = "0 0 24 24" > <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg > Copied!`;
            btn.classList.remove('bg-indigo-500/20', 'text-indigo-400', 'border-indigo-500/30');
            btn.classList.add('bg-green-500/20', 'text-green-400', 'border-green-500/30');

            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.classList.add('bg-indigo-500/20', 'text-indigo-400', 'border-indigo-500/30');
                btn.classList.remove('bg-green-500/20', 'text-green-400', 'border-green-500/30');
            }, 1500);
        }

        window.copyItemDetails = function (event) {
            const description = document.getElementById('item-description').value;
            document.getElementById('item-download-description').value = description;

            // Visual Feedback
            const btn = event.currentTarget || event.target;
            const originalContent = btn.innerHTML;
            btn.innerHTML = `< svg class="w-3 h-3" fill = "none" stroke = "currentColor" viewBox = "0 0 24 24" > <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg > Copied!`;
            btn.classList.remove('bg-indigo-500/20', 'text-indigo-400', 'border-indigo-500/30');
            btn.classList.add('bg-green-500/20', 'text-green-400', 'border-green-500/30');

            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.classList.add('bg-indigo-500/20', 'text-indigo-400', 'border-indigo-500/30');
                btn.classList.remove('bg-green-500/20', 'text-green-400', 'border-green-500/30');
            }, 1500);
        }
    </script>
    <!-- Banner Modal -->
    <div id="banner-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBannerModal()"></div>
        <div
            class="bg-[#0f172a] rounded-2xl shadow-2xl w-full max-w-2xl relative z-10 border border-indigo-500/30 flex flex-col max-h-[90vh]">
            <div
                class="p-6 border-b border-gray-800 flex justify-between items-center bg-gradient-to-r from-gray-900 to-[#1e1b4b]">
                <h3 id="banner-modal-title" class="text-xl font-bold text-white flex items-center gap-2">
                    <!-- Dynamic title injected via JS -->
                </h3>
                <button onclick="closeBannerModal()"
                    class="text-gray-400 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="p-6 overflow-y-auto custom-scrollbar space-y-5">
                <input type="hidden" id="banner-id">

                <div class="grid grid-cols-2 gap-5">
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-indigo-300 mb-1.5">Banner Image URL *</label>
                        <div class="flex gap-2">
                            <input type="url" id="banner-image"
                                class="flex-1 bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all placeholder-gray-600"
                                placeholder="https://..." required onchange="previewBannerImage(this.value)">
                            <button type="button" onclick="openImagePicker('banner-image')"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center gap-2"
                                title="Choose from Assets">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                            </button>
                            <button type="button"
                                onclick="window.open(document.getElementById('banner-image').value, '_blank')"
                                class="bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-lg border border-gray-700 transition-colors"
                                title="Preview Link">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <div id="banner-preview-container"
                            class="mt-3 hidden rounded-lg overflow-hidden border border-gray-700 h-40 bg-gray-900 relative">
                            <img id="banner-preview" src="" class="w-full h-full object-cover opacity-70">
                            <div
                                class="absolute inset-0 flex items-center justify-center text-sm font-bold text-white bg-black/50">
                                Image Preview</div>
                        </div>
                    </div>

                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-400 mb-1.5">Title *</label>
                        <input type="text" id="banner-title"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                            placeholder="e.g. Easy Workflow" required>
                    </div>

                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-400 mb-1.5">Subtitle</label>
                        <input type="text" id="banner-subtitle"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                            placeholder="e.g. A Script by Harsh Edits">
                    </div>

                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-400 mb-1.5">Description</label>
                        <textarea id="banner-description" rows="3"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all resize-none"
                            placeholder="Brief description..."></textarea>
                    </div>

                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-400 mb-1.5">Button Text</label>
                        <input type="text" id="banner-btn-text"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                            placeholder="e.g. Download Now">
                    </div>

                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-400 mb-1.5 flex justify-between">
                            Button URL
                            <button type="button"
                                onclick="document.getElementById('banner-btn-url').value = 'javascript:showEasyWorkflowView()'"
                                class="text-xs text-indigo-400 hover:text-white transition-colors">
                                Use Easy Workflow Action
                            </button>
                        </label>
                        <input type="text" id="banner-btn-url"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"
                            placeholder="#">
                    </div>

                    <!-- Display Order Removed (Handled via Drag & Drop) -->

                    <!-- Detail View Settings -->
                    <div class="col-span-2 border-t border-gray-800 pt-5 mt-2">
                        <h4 class="text-white font-bold mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                            Landing Page Details
                            <span class="text-xs font-normal text-gray-500 ml-2">(Used when Action is set to Easy
                                Workflow View)</span>
                            <button type="button" onclick="copyBannerDetails(event)"
                                class="text-xs bg-indigo-500/20 hover:bg-indigo-500 hover:text-white text-indigo-400 px-3 py-1 rounded-lg transition-colors border border-indigo-500/30 ml-auto flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                                Copy from Banner Details
                            </button>
                        </h4>

                        <div class="grid grid-cols-2 gap-5">
                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-sm font-medium text-gray-400 mb-1.5">Page Title</label>
                                <input type="text" id="banner-detail-title"
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none"
                                    placeholder="e.g. Font Replacer">
                            </div>
                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-sm font-medium text-gray-400 mb-1.5">Page Subtitle /
                                    Author</label>
                                <input type="text" id="banner-detail-subtitle"
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none"
                                    placeholder="e.g. A Script by Harsh Edits">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-400 mb-1.5">Page Description</label>
                                <textarea id="banner-detail-description" rows="3"
                                    class="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none resize-none"
                                    placeholder="Detailed description for the landing page..."></textarea>
                            </div>

                            <!-- Versions Manager -->
                            <div class="col-span-2">
                                <label
                                    class="block text-sm font-medium text-gray-400 mb-2 flex justify-between items-center">
                                    Download Versions
                                    <button type="button" onclick="addBannerVersionField('', '')"
                                        class="text-indigo-400 hover:text-indigo-300 text-sm font-semibold flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                        </svg>
                                        Add Version
                                    </button>
                                </label>
                                <div id="banner-versions-container" class="space-y-3">
                                    <!-- Dynamic rows -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-2 md:col-span-1 flex flex-col items-end gap-2">
                        <label
                            class="flex items-center gap-3 cursor-pointer bg-gray-900 border border-gray-700 rounded-lg p-3 w-full hover:bg-gray-800 transition-colors">
                            <input type="checkbox" id="banner-active"
                                class="w-5 h-5 rounded border-gray-600 text-indigo-600 focus:ring-indigo-500 bg-gray-800"
                                checked>
                            <span class="text-white font-medium">Active (Visible)</span>
                        </label>

                        <label
                            class="flex items-center gap-3 cursor-pointer bg-gray-900 border border-gray-700 rounded-lg p-3 w-full hover:bg-gray-800 transition-colors">
                            <input type="checkbox" id="banner-workflow-video-bg"
                                class="w-5 h-5 rounded border-gray-600 text-indigo-600 focus:ring-indigo-500 bg-gray-800">
                            <span class="text-white font-medium">Enable Workflow Video</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-gray-800 flex justify-end gap-3 bg-gray-900/50 rounded-b-2xl">
                <button onclick="closeBannerModal()"
                    class="px-5 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 font-medium transition-all">Cancel</button>
                <button onclick="saveBanner()"
                    class="px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-lg shadow-lg shadow-indigo-600/20 font-bold transition-all transform hover:scale-105">Save
                    Banner</button>
            </div>
        </div>
    </div>
    <!-- Premium Bulk Import Modal -->
    <div id="sub-items-bulk-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-md transition-opacity"
            onclick="closeSubItemsImportModal()">
        </div>
        <div
            class="relative w-full max-w-2xl bg-[#111116] border border-white/10 rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-scale-in">

            <!-- Header -->
            <div class="px-8 py-6 border-b border-gray-800 flex justify-between items-center bg-gray-900/50">
                <div>
                    <h3 class="text-2xl font-bold text-white tracking-tight flex items-center gap-3">
                        <span class="bg-indigo-500/20 text-indigo-400 p-2 rounded-lg">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                            </svg>
                        </span>
                        Import Sub-Items
                    </h3>
                    <p class="text-gray-400 text-sm mt-1 ml-11">Paste your resource list to bulk add items instantly.
                    </p>
                </div>
                <button onclick="closeSubItemsImportModal()"
                    class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-white/5 rounded-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Content -->
            <div class="p-8 space-y-6">
                <div class="bg-indigo-900/10 border border-indigo-500/20 rounded-xl p-4 flex gap-3">
                    <svg class="w-5 h-5 text-indigo-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm text-indigo-200">
                        <span class="font-bold text-indigo-100">Format:</span> Title | Download Link | Preview Link
                        (Optional)
                        <br>
                        <span class="text-xs opacity-70 mt-1 block">Example: Pack Part 1 | https://drive.google... |
                            https://preview.com...</span>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-300 mb-2">Paste Content</label>
                    <textarea id="bulk-import-textarea" rows="8"
                        class="w-full bg-gray-900/50 border border-gray-700 rounded-xl p-4 text-white placeholder-gray-600 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all font-mono text-sm leading-relaxed custom-scrollbar shadow-inner"
                        placeholder="Pack 1 | https://link1.com | https://preview1.com&#10;Pack 2 | https://link2.com"></textarea>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex justify-end gap-3 pt-4 border-t border-gray-800">
                <button onclick="closeSubItemsImportModal()"
                    class="px-5 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 font-medium transition-all">Cancel</button>
                <button onclick="processSubItemsImport()"
                    class="px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-lg shadow-lg shadow-indigo-600/20 font-bold transition-all transform hover:scale-105 active:scale-95 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Process & Add
                </button>
            </div>
        </div>
    </div>
    <div id="toast-container"></div>

    <script>
        // Keyboard Navigation for Sidebar
        document.addEventListener('keydown', function (e) {
            // Provide a way to disable if user is typing in an input
            if (['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) return;

            const sidebarLinks = Array.from(document.querySelectorAll('.sidebar-link'));
            const activeLink = document.querySelector('.sidebar-link.active');
            let currentIndex = sidebarLinks.indexOf(activeLink);

            if (e.key === 'ArrowUp') {
                e.preventDefault();
                let nextIndex = currentIndex - 1;
                if (nextIndex < 0) nextIndex = sidebarLinks.length - 1;
                sidebarLinks[nextIndex].click();
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                let nextIndex = currentIndex + 1;
                if (nextIndex >= sidebarLinks.length) nextIndex = 0;
                sidebarLinks[nextIndex].click();
            }
        });
    </script>
</body>

</html>